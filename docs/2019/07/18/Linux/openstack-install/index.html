<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="https://www.lengqing.org/pics/blog/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.lengqing.org/pics/blog/logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.lengqing.org/pics/blog/logo.png">
  <link rel="mask-icon" href="https://www.lengqing.org/pics/blog/logo.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="本文参考：OpenStack安装指南 指南中提到指南不适用于生产系统安装，而是为了学习OpenStack而创建最小概念验证。 指南中要求的硬件：  1个控制节点，拥有1-2CPU，8G RAM，100GB存储，2NIC 至少一个计算节点，每个节点拥有2-4+CPU，8+G RAM，100+GB存储，2NIC 可选1个块存储节点，拥有1-2CPU，4G RAM，100+GB存储，1NIC 可选多个对">
<meta property="og:type" content="article">
<meta property="og:title" content="Ubuntu Server 18.04 安装 OpenStack Stein">
<meta property="og:url" content="https://www.lengqing.org/2019/07/18/Linux/openstack-install/index.html">
<meta property="og:site_name" content="冷清的主页">
<meta property="og:description" content="本文参考：OpenStack安装指南 指南中提到指南不适用于生产系统安装，而是为了学习OpenStack而创建最小概念验证。 指南中要求的硬件：  1个控制节点，拥有1-2CPU，8G RAM，100GB存储，2NIC 至少一个计算节点，每个节点拥有2-4+CPU，8+G RAM，100+GB存储，2NIC 可选1个块存储节点，拥有1-2CPU，4G RAM，100+GB存储，1NIC 可选多个对">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-10-26T21:00:06.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ubuntu Server 18.04 安装 OpenStack Stein">
<meta name="twitter:description" content="本文参考：OpenStack安装指南 指南中提到指南不适用于生产系统安装，而是为了学习OpenStack而创建最小概念验证。 指南中要求的硬件：  1个控制节点，拥有1-2CPU，8G RAM，100GB存储，2NIC 至少一个计算节点，每个节点拥有2-4+CPU，8+G RAM，100+GB存储，2NIC 可选1个块存储节点，拥有1-2CPU，4G RAM，100+GB存储，1NIC 可选多个对">

<link rel="canonical" href="https://www.lengqing.org/2019/07/18/Linux/openstack-install/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Ubuntu Server 18.04 安装 OpenStack Stein | 冷清的主页</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">冷清的主页</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">闲暇时也许会更新吧</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about.html" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.lengqing.org/2019/07/18/Linux/openstack-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blog.lengqing.org/pics/blog/touxiangc.png">
      <meta itemprop="name" content="lengqing5977">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冷清的主页">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Ubuntu Server 18.04 安装 OpenStack Stein
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-18 06:18:00" itemprop="dateCreated datePublished" datetime="2019-07-18T06:18:00+08:00">2019-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-27 05:00:06" itemprop="dateModified" datetime="2019-10-27T05:00:06+08:00">2019-10-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><strong>本文参考：<a href="https://docs.openstack.org/install-guide/index.html" target="_blank" rel="noopener">OpenStack安装指南</a></strong></p>
<p><strong>指南中提到指南不适用于生产系统安装，而是为了学习OpenStack而创建最小概念验证。</strong></p>
<p><strong>指南中要求的硬件：</strong></p>
<blockquote>
<p>1个控制节点，拥有1-2CPU，8G RAM，100GB存储，2NIC</p>
<p>至少一个计算节点，每个节点拥有2-4+CPU，8+G RAM，100+GB存储，2NIC</p>
<p>可选1个块存储节点，拥有1-2CPU，4G RAM，100+GB存储，1NIC</p>
<p>可选多个对象存储节点，每个节点拥有1-2CPU，4+GB RAM，100+GB存储，1NIC</p>
<p>网络，提供商网络 / 自助服务网络，二选一，自助服务网络基于提供商网络，但更复杂。</p>
</blockquote>
<p><strong>指南中提到的最低硬件要求：</strong></p>
<blockquote>
<p>控制节点：1个处理器，4 GB内存和5 GB存储</p>
<p>计算节点：1个处理器，2 GB内存和10 GB存储</p>
</blockquote>
<p><strong>指南中提到的密码引用<a href="https://docs.openstack.org/install-guide/environment-security.html" target="_blank" rel="noopener">地址</a></strong></p>
<hr>
<h1 id="0-本文操作时的环境"><a href="#0-本文操作时的环境" class="headerlink" title="0 本文操作时的环境"></a>0 本文操作时的环境</h1><p><strong>本文所有系统均为VMware Workstation 15 Pro中的Ubuntu Server 18.04.2虚拟机</strong></p>
<p><strong>本文仅选择控制节点和计算节点，存储使用本地存储，不使用存储节点</strong></p>
<p><strong>控制节点</strong>：2核CPU，4G RAM，100GB存储，2网络接口（ens33：192.168.2.50，ens38：192.168.2.52）</p>
<p><strong>计算节点</strong>：4核CPU，4G RAM，100GB存储，2网络接口（ens33：192.168.2.51，ens38：192.168.2.53）</p>
<p><strong>网络</strong>：VMware虚拟网络</p>
<h1 id="1-安装前配置"><a href="#1-安装前配置" class="headerlink" title="1 安装前配置"></a>1 安装前配置</h1><h2 id="1-1-配置网络接口"><a href="#1-1-配置网络接口" class="headerlink" title="1.1 配置网络接口"></a>1.1 配置网络接口</h2><h3 id="1-1-1-控制节点"><a href="#1-1-1-控制节点" class="headerlink" title="1.1.1 控制节点"></a>1.1.1 控制节点</h3><p>配置第一个接口作为管理接口：</p>
<p>IP地址：192.168.2.50</p>
<p>网络掩码：255.255.255.0（或/24）</p>
<p>默认网关：192.168.2.1</p>
<p>Ubuntu静态IP配置就不举例了，我这里直接DHCP服务器绑定了MAC地址和IP。</p>
<h3 id="1-1-2-计算节点"><a href="#1-1-2-计算节点" class="headerlink" title="1.1.2 计算节点"></a>1.1.2 计算节点</h3><p>差不多与控制节点完全一样</p>
<p>配置第一个接口作为管理接口：</p>
<p>IP地址：192.168.2.51</p>
<p>网络掩码：255.255.255.0（或/ 24）</p>
<p>默认网关：192.168.2.1</p>
<h2 id="1-2-配置名称解析"><a href="#1-2-配置名称解析" class="headerlink" title="1.2 配置名称解析"></a>1.2 配置名称解析</h2><h3 id="1-2-1-控制节点"><a href="#1-2-1-控制节点" class="headerlink" title="1.2.1 控制节点"></a>1.2.1 控制节点</h3><p>将节点的主机名设置为controller。</p>
<p>编辑/etc/hosts文件，添加以下内容</p>
<blockquote>
<p>#controller</p>
<p>192.168.2.50      controller</p>
<p>#compute1</p>
<p>192.168.2.51      compute1</p>
<p>#下面是块存储和对象存储的示例，有的话才需要</p>
<p>#block1<br>10.0.0.41       block1</p>
<p>#object1<br>10.0.0.51       object1</p>
<p>#object2<br>10.0.0.52       object2</p>
</blockquote>
<h3 id="1-2-2-计算节点"><a href="#1-2-2-计算节点" class="headerlink" title="1.2.2 计算节点"></a>1.2.2 计算节点</h3><p>将节点的主机名设置为compute1。</p>
<p>编辑/etc/hosts文件，添加以下内容</p>
<blockquote>
<p>#controller</p>
<p>192.168.2.50      controller</p>
<p>#compute1</p>
<p>192.168.2.51      compute1</p>
<p>#下面是块存储和对象存储的示例，有的话才需要</p>
<p>#block1<br>10.0.0.41       block1</p>
<p>#object1<br>10.0.0.51       object1</p>
<p>#object2<br>10.0.0.52       object2</p>
</blockquote>
<h2 id="1-3-验证连接"><a href="#1-3-验证连接" class="headerlink" title="1.3 验证连接"></a>1.3 验证连接</h2><p>都ping通了就算成功了</p>
<h3 id="1-3-1-控制节点"><a href="#1-3-1-控制节点" class="headerlink" title="1.3.1 控制节点"></a>1.3.1 控制节点</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping -c 4 docs.openstack.org</span><br><span class="line">ping -c 4 compute1</span><br></pre></td></tr></table></figure>

<h3 id="1-3-2-计算节点"><a href="#1-3-2-计算节点" class="headerlink" title="1.3.2 计算节点"></a>1.3.2 计算节点</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping -c 4 openstack.org</span><br><span class="line">ping -c 4 controller</span><br></pre></td></tr></table></figure>

<h2 id="1-4-NTP网络时间协议"><a href="#1-4-NTP网络时间协议" class="headerlink" title="1.4 NTP网络时间协议"></a>1.4 NTP网络时间协议</h2><p>控制节点使用网络上的NTP服务器同步时间，其它节点使用控制节点同步时间</p>
<h3 id="1-4-1-控制节点"><a href="#1-4-1-控制节点" class="headerlink" title="1.4.1 控制节点"></a>1.4.1 控制节点</h3><p>安装chrony</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install chrony</span><br></pre></td></tr></table></figure>

<p>修改/etc/chrony/chrony.conf，<br>使用cn.ntp.org.cn，添加以下内容</p>
<blockquote>
<p>server cn.ntp.org.cn iburst</p>
</blockquote>
<p>允许其它节点连接控制节点，添加以下内容</p>
<blockquote>
<p>allow 192.168.2.0/24</p>
</blockquote>
<p>重启NTP服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service chrony restart</span><br></pre></td></tr></table></figure>

<h3 id="1-4-2-计算节点"><a href="#1-4-2-计算节点" class="headerlink" title="1.4.2 计算节点"></a>1.4.2 计算节点</h3><p>安装chrony</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install chrony</span><br></pre></td></tr></table></figure>

<p>修改/etc/chrony/chrony.conf，<br>使用cn.ntp.org.cn，添加以下内容</p>
<blockquote>
<p>server controller iburst</p>
</blockquote>
<p>注释掉其它的服务器</p>
<blockquote>
<p>pool ntp.ubuntu.com        iburst maxsources 4<br>ool 0.ubuntu.pool.ntp.org iburst maxsources 1<br>ool 1.ubuntu.pool.ntp.org iburst maxsources 1<br>ool 2.ubuntu.pool.ntp.org iburst maxsources 2</p>
</blockquote>
<p>重启NTP服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service chrony restart</span><br></pre></td></tr></table></figure>

<h2 id="1-5-验证NTP设置"><a href="#1-5-验证NTP设置" class="headerlink" title="1.5 验证NTP设置"></a>1.5 验证NTP设置</h2><p><a href="https://docs.openstack.org/install-guide/environment-ntp-verify.html" target="_blank" rel="noopener">此链接上这个样子就成功了</a></p>
<h3 id="1-5-1-控制节点"><a href="#1-5-1-控制节点" class="headerlink" title="1.5.1 控制节点"></a>1.5.1 控制节点</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chronyc sources</span><br></pre></td></tr></table></figure>

<h3 id="1-5-2-计算节点"><a href="#1-5-2-计算节点" class="headerlink" title="1.5.2 计算节点"></a>1.5.2 计算节点</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chronyc sources</span><br></pre></td></tr></table></figure>

<h1 id="2-安装环境"><a href="#2-安装环境" class="headerlink" title="2 安装环境"></a>2 安装环境</h1><h2 id="2-1-为Ubuntu-Cloud-Archive启用存储库"><a href="#2-1-为Ubuntu-Cloud-Archive启用存储库" class="headerlink" title="2.1 为Ubuntu Cloud Archive启用存储库"></a>2.1 为Ubuntu Cloud Archive启用存储库</h2><h3 id="2-1-1-这应该是所有节点都要做的"><a href="#2-1-1-这应该是所有节点都要做的" class="headerlink" title="2.1.1 这应该是所有节点都要做的"></a>2.1.1 这应该是所有节点都要做的</h3><p>添加存储库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add-apt-repository cloud-archive:stein</span><br></pre></td></tr></table></figure>

<h2 id="2-2-安装OpenStack客户端"><a href="#2-2-安装OpenStack客户端" class="headerlink" title="2.2 安装OpenStack客户端"></a>2.2 安装OpenStack客户端</h2><h3 id="2-2-1-这应该是所有节点都要做的"><a href="#2-2-1-这应该是所有节点都要做的" class="headerlink" title="2.2.1 这应该是所有节点都要做的"></a>2.2.1 这应该是所有节点都要做的</h3><p>更新，如果升级中包含新内核，需要重启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update &amp;&amp; apt-get dist-upgrade</span><br></pre></td></tr></table></figure>

<p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python3-openstackclient</span><br></pre></td></tr></table></figure>

<h2 id="2-3-数据库的安装与配置"><a href="#2-3-数据库的安装与配置" class="headerlink" title="2.3 数据库的安装与配置"></a>2.3 数据库的安装与配置</h2><h3 id="2-3-1-数据库仅需要在控制节点安装"><a href="#2-3-1-数据库仅需要在控制节点安装" class="headerlink" title="2.3.1 数据库仅需要在控制节点安装"></a>2.3.1 数据库仅需要在控制节点安装</h3><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install mariadb-server python-pymysql</span><br></pre></td></tr></table></figure>

<p>创建并编辑/etc/mysql/mariadb.conf.d/99-openstack.cnf文件，并将bind-address 密钥设置为控制器节点的管理IP地址，以允许其他节点通过管理网络进行访问。设置其他键以启用有用选项和UTF-8字符集：</p>
<blockquote>
<p>[mysqld]</p>
<p>bind-address = 192.168.2.50</p>
<p>default-storage-engine = innodb</p>
<p>innodb_file_per_table = on</p>
<p>max_connections = 4096</p>
<p>collation-server = utf8_general_ci</p>
<p>character-set-server = utf8</p>
</blockquote>
<p>重启数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>

<p>数据库初始化设置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure>

<h2 id="2-4-消息队列"><a href="#2-4-消息队列" class="headerlink" title="2.4 消息队列"></a>2.4 消息队列</h2><h3 id="2-4-1-消息队列仅在控制节点运行"><a href="#2-4-1-消息队列仅在控制节点运行" class="headerlink" title="2.4.1 消息队列仅在控制节点运行"></a>2.4.1 消息队列仅在控制节点运行</h3><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install rabbitmq-server</span><br></pre></td></tr></table></figure>

<p>添加openstack用户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl add_user openstack 用户密码</span><br></pre></td></tr></table></figure>

<p>允许用户进行配置，写入和读取访问 <code>openstack</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl set_permissions openstack ".*" ".*" ".*"</span><br></pre></td></tr></table></figure>

<h2 id="2-5-Memcached（身份验证）"><a href="#2-5-Memcached（身份验证）" class="headerlink" title="2.5 Memcached（身份验证）"></a>2.5 Memcached（身份验证）</h2><h3 id="2-5-1-Memcached仅在控制节点运行"><a href="#2-5-1-Memcached仅在控制节点运行" class="headerlink" title="2.5.1 Memcached仅在控制节点运行"></a>2.5.1 Memcached仅在控制节点运行</h3><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install memcached python-memcache</span><br></pre></td></tr></table></figure>

<p>编辑<code>/etc/memcached.conf</code>文件并配置服务以使用控制器节点的管理IP地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/memcached.conf</span><br></pre></td></tr></table></figure>

<p>改变现有行</p>
<blockquote>
<p>-l 192.168.2.50</p>
</blockquote>
<p>重启memcached服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service memcached restart</span><br></pre></td></tr></table></figure>

<h2 id="2-6-Etcd（分布式键值对数据存储系统）"><a href="#2-6-Etcd（分布式键值对数据存储系统）" class="headerlink" title="2.6 Etcd（分布式键值对数据存储系统）"></a>2.6 Etcd（分布式键值对数据存储系统）</h2><h3 id="2-6-1-Etcd仅在控制节点运行"><a href="#2-6-1-Etcd仅在控制节点运行" class="headerlink" title="2.6.1 Etcd仅在控制节点运行"></a>2.6.1 Etcd仅在控制节点运行</h3><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install etcd</span><br></pre></td></tr></table></figure>

<p>编辑<code>/etc/default/etcd</code>文件并设置<code>ETCD_INITIAL_CLUSTER</code>， <code>ETCD_INITIAL_ADVERTISE_PEER_URLS</code>，<code>ETCD_ADVERTISE_CLIENT_URLS</code>， <code>ETCD_LISTEN_CLIENT_URLS</code>控制器节点</p>
<blockquote>
<p>ETCD_NAME=”controller”</p>
<p>ETCD_DATA_DIR=”/var/lib/etcd”</p>
<p>ETCD_INITIAL_CLUSTER_STATE=”new”</p>
<p>ETCD_INITIAL_CLUSTER_TOKEN=”etcd-cluster-01”</p>
<p>ETCD_INITIAL_CLUSTER=”controller=<a href="http://192.168.2.50:2380&quot;" target="_blank" rel="noopener">http://192.168.2.50:2380&quot;</a></p>
<p>ETCD_INITIAL_ADVERTISE_PEER_URLS=”<a href="http://192.168.2.50:2380&quot;" target="_blank" rel="noopener">http://192.168.2.50:2380&quot;</a></p>
<p>ETCD_ADVERTISE_CLIENT_URLS=”<a href="http://192.168.2.50:2379&quot;" target="_blank" rel="noopener">http://192.168.2.50:2379&quot;</a></p>
<p>ETCD_LISTEN_PEER_URLS=”<a href="http://0.0.0.0:2380&quot;" target="_blank" rel="noopener">http://0.0.0.0:2380&quot;</a></p>
<p>ETCD_LISTEN_CLIENT_URLS=”<a href="http://192.168.2.50:2379&quot;" target="_blank" rel="noopener">http://192.168.2.50:2379&quot;</a></p>
</blockquote>
<p>启动启用服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable etcd</span><br><span class="line">systemctl start etcd</span><br></pre></td></tr></table></figure>

<h1 id="3-安装OpenStack服务"><a href="#3-安装OpenStack服务" class="headerlink" title="3 安装OpenStack服务"></a>3 安装OpenStack服务</h1><p><strong>Stein的最小部署</strong></p>
<p>至少需要安装以下服务。按以下指定的顺序安装服务：<br>身份服务 – <a href="https://docs.openstack.org/keystone/stein/install/" target="_blank" rel="noopener">keystone installation for Stein</a><br>映像服务 – <a href="https://docs.openstack.org/glance/stein/install/" target="_blank" rel="noopener">glance installation for Stein</a><br>安置服务 – <a href="https://docs.openstack.org/placement/stein/install/" target="_blank" rel="noopener">placement installation for Stein</a><br>计算服务 – <a href="https://docs.openstack.org/nova/stein/install/" target="_blank" rel="noopener">nova installation for Stein</a><br>网络服务 – <a href="https://docs.openstack.org/neutron/stein/install/" target="_blank" rel="noopener">neutron installation for Stein</a></p>
<p>指南建议在安装最小部署服务后也安装以下组件：<br>仪表盘 – <a href="https://docs.openstack.org/horizon/stein/install/" target="_blank" rel="noopener">horizon installation for Stein</a><br>块存储服务 – <a href="https://docs.openstack.org/cinder/stein/install/" target="_blank" rel="noopener">cinder installation for Stein</a></p>
<p><strong>Stein所有的服务</strong></p>
<p><a href="https://docs.openstack.org/stein/install/" target="_blank" rel="noopener">https://docs.openstack.org/stein/install/</a></p>
<h2 id="3-1-身份服务"><a href="#3-1-身份服务" class="headerlink" title="3.1 身份服务"></a>3.1 身份服务</h2><h3 id="3-1-1-身份服务仅在控制节点上运行"><a href="#3-1-1-身份服务仅在控制节点上运行" class="headerlink" title="3.1.1 身份服务仅在控制节点上运行"></a>3.1.1 身份服务仅在控制节点上运行</h3><h4 id="3-1-1-1-先决条件（创建数据库）"><a href="#3-1-1-1-先决条件（创建数据库）" class="headerlink" title="3.1.1.1 先决条件（创建数据库）"></a>3.1.1.1 先决条件（创建数据库）</h4><ol>
<li><p>使用数据库访问客户端以<code>root</code>用户身份连接到数据库服务器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建<code>keystone</code>数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE keystone;</span><br></pre></td></tr></table></figure>
</li>
<li><p>授予对<code>keystone</code>数据库的适当访问权限：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' \</span><br><span class="line">IDENTIFIED BY 'KEYSTONE_DBPASS';</span><br><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' \</span><br><span class="line">IDENTIFIED BY 'KEYSTONE_DBPASS';</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>替换<code>KEYSTONE_DBPASS</code>为合适的密码。</p>
<ol start="4">
<li>退出数据库</li>
</ol>
<h4 id="3-1-1-2-安装和配置组件"><a href="#3-1-1-2-安装和配置组件" class="headerlink" title="3.1.1.2 安装和配置组件"></a>3.1.1.2 安装和配置组件</h4><ol>
<li><p>安装软件包，如果包管理提示依赖问题，就把<code>keyston</code>单独安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install keystone apache2 libapache2-mod-wsgi</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>/etc/keystone/keystone.conf</code>文件并完成以下操作</p>
<p>在该[database]`部分中，配置数据库访问：</p>
<blockquote>
<p>[database]<br>connection = mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone</p>
</blockquote>
<p>替换<code>KEYSTONE_DBPASS</code>为您为数据库选择的密码。</p>
<p>在该<code>[token]</code>部分中，配置Fernet令牌提供程序：</p>
<blockquote>
<p>[token]<br>provider = fernet</p>
</blockquote>
</li>
<li><p>填充Identity服务数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c "keystone-manage db_sync" keystone</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>4.初始化Fernet密钥存储库：</p>
   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line">keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span><br></pre></td></tr></table></figure>

<p>   5.引导身份服务：</p>
   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">keystone-manage bootstrap --bootstrap-password ADMIN_PASS \</span><br><span class="line">--bootstrap-admin-url http://controller:5000/v3/ \</span><br><span class="line">--bootstrap-internal-url http://controller:5000/v3/ \</span><br><span class="line">--bootstrap-public-url http://controller:5000/v3/ \</span><br><span class="line">--bootstrap-region-id RegionOne</span><br></pre></td></tr></table></figure>

<p>   替换ADMIN_PASS为管理用户的合适密码。</p>
<h4 id="3-1-1-3-配置Apache-HTTP服务器"><a href="#3-1-1-3-配置Apache-HTTP服务器" class="headerlink" title="3.1.1.3 配置Apache HTTP服务器"></a>3.1.1.3 配置Apache HTTP服务器</h4><p>编辑<code>/etc/apache2/apache2.conf</code>文件并配置<code>ServerName</code>引用控制器节点的 选项：</p>
<blockquote>
<p>ServerName controller</p>
</blockquote>
<p><strong>SSL</strong><br>这里没说</p>
<h4 id="3-1-1-4-完成安装"><a href="#3-1-1-4-完成安装" class="headerlink" title="3.1.1.4 完成安装"></a>3.1.1.4 完成安装</h4><p>重启Apache服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service apache2 restart</span><br></pre></td></tr></table></figure>

<p>配置管理帐户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export OS_USERNAME=admin</span><br><span class="line">export OS_PASSWORD=ADMIN_PASS</span><br><span class="line">export OS_PROJECT_NAME=admin</span><br><span class="line">export OS_USER_DOMAIN_NAME=Default</span><br><span class="line">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br></pre></td></tr></table></figure>

<p>替换ADMIN_PASS为3.1.1.2中keystone-manage bootstrap命令中使用的密码。</p>
<h4 id="3-1-1-5-创建域，项目，用户和角色"><a href="#3-1-1-5-创建域，项目，用户和角色" class="headerlink" title="3.1.1.5 创建域，项目，用户和角色"></a>3.1.1.5 创建域，项目，用户和角色</h4><p>创建新域</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">openstack domain create --description "An Example Domain" example</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | An Example Domain                |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 54b9ba6ef9814e17bb3de96ace8870bd |</span><br><span class="line">| name        | example                          |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>创建服务项目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack project create --domain default \</span><br><span class="line">  --description "Service Project" service</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Service Project                  |</span><br><span class="line">| domain_id   | default                          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | b0de8cb0e1134f53a8286152f68d992c |</span><br><span class="line">| is_domain   | False                            |</span><br><span class="line">| name        | service                          |</span><br><span class="line">| parent_id   | default                          |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>创建<code>myproject</code>项目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack project create --domain default \</span><br><span class="line">  --description "Demo Project" myproject</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Demo Project                     |</span><br><span class="line">| domain_id   | default                          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 497005cae90144ab83a557650e1cb8b1 |</span><br><span class="line">| is_domain   | False                            |</span><br><span class="line">| name        | myproject                        |</span><br><span class="line">| parent_id   | default                          |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>创建<code>myuser</code> 用户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack user create --domain default \</span><br><span class="line">  --password-prompt myuser</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | 375d48d3283e42d5918a5b51b950cfe1 |</span><br><span class="line">| name                | myuser                           |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>创建<code>myrole</code>角色</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  openstack role create myrole</span><br><span class="line"><span class="meta">  #</span>输出</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | None                             |</span><br><span class="line">| domain_id   | None                             |</span><br><span class="line">| id          | 9d84709f4538497fa80d2482846a78f5 |</span><br><span class="line">| name        | myrole                           |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>将<code>myrole</code>角色添加到<code>myproject</code>项目和<code>myuser</code>用户：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role add --project myproject --user myuser myrole</span><br></pre></td></tr></table></figure>

<h4 id="3-1-1-6-验证操作"><a href="#3-1-1-6-验证操作" class="headerlink" title="3.1.1.6 验证操作"></a>3.1.1.6 验证操作</h4><ol>
<li><p>取消设置临时 变量<code>OS_AUTH_URL</code>和<code>OS_PASSWORD</code>环境变量：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unset OS_AUTH_URL OS_PASSWORD</span><br></pre></td></tr></table></figure>
</li>
<li><p>作为<code>admin</code>用户，请求身份验证令牌：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack --os-auth-url http://controller:5000/v3 \</span><br><span class="line">  --os-project-domain-name Default --os-user-domain-name Default \</span><br><span class="line">  --os-project-name admin --os-username admin token issue</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">Password:</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                           |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| expires    | 2019-07-18T03:19:00+0000                                        |</span><br><span class="line">| id         | gAAAAABdL9cUXCY-Lk7j9qkxXHOIihLju5ruoWM4vzdcJEPSCBakUB-V9u0z4lU |</span><br><span class="line">|            | nEZGimv6_wR6zdPndtV7BzyMV52vhEVBkyXLaa7AMuJ545yyME1lDGyHESGcmVi |</span><br><span class="line">|            |4kNan6QYsNL3B_AidXqxejFohgm81oDFJ8X4vIlucpLnk4ogA-C1amJbU        |</span><br><span class="line">| project_id |  ddab7b9e10d14c59a64143a8f04ac045                               |</span><br><span class="line">| user_id    | 835091030b714480b7ec1bbe9c3a9f15                                |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>注意，此命令使用<code>admin</code>用户的密码。</p>
</li>
<li><p>正如<code>myuser</code>用户在上一个中创建的那样，请求一个身份验证令牌：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack --os-auth-url http://controller:5000/v3 \</span><br><span class="line">  --os-project-domain-name Default --os-user-domain-name Default \</span><br><span class="line">  --os-project-name myproject --os-username myuser token issue</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">Password:</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                           |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| expires    |  2019-07-18T03:22:46+0000                                       |</span><br><span class="line">| id         | gAAAAABdL9f2pKqTes1RBP8tiqtAWbd2_GHXvFVLCJ4Hc1XSDQRqpTJxt2XorNc |</span><br><span class="line">|            | 2HeaKCo8ZzlUsA_CFCYwsX02vtlvVFoAFs5Q6xFvI9tageBtJpxewSeL8Qq5kmC |</span><br><span class="line">|            | kaUIMdGgNlMGNf0GSsq9qOfZuyXuw0NEofb37KV8UlrGtjYGfebjjUORI       |</span><br><span class="line">| project_id | 497005cae90144ab83a557650e1cb8b1                                |</span><br><span class="line">| user_id    | 375d48d3283e42d5918a5b51b950cfe1                                |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="3-1-1-7-创建OpenStack客户端环境脚本"><a href="#3-1-1-7-创建OpenStack客户端环境脚本" class="headerlink" title="3.1.1.7 创建OpenStack客户端环境脚本"></a>3.1.1.7 创建OpenStack客户端环境脚本</h4><p>创建客户端环境的脚本<code>admin</code>和<code>demo</code> 项目和用户。本指南的后续部分引用这些脚本来加载客户端操作的适当凭据。<br>注意，客户端环境脚本的路径不受限制。为方便起见，您可以将脚本放在任何位置，但请确保它们可以访问并位于适合部署的安全位置，因为它们包含敏感凭据。</p>
<ol>
<li><p>创建和编辑<code>admin-openrc</code>文件并添加以下内容：</p>
<p>注意，OpenStack客户端还支持使用<code>clouds.yaml</code>文件。有关更多信息，请参阅<a href="http://docs.openstack.org/os-client-config/latest" target="_blank" rel="noopener">os-client-config</a>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">export OS_USER_DOMAIN_NAME=Default</span><br><span class="line">export OS_PROJECT_NAME=admin</span><br><span class="line">export OS_USERNAME=admin</span><br><span class="line">export OS_PASSWORD=ADMIN_PASS</span><br><span class="line">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">export OS_IMAGE_API_VERSION=2</span><br></pre></td></tr></table></figure>

<p>替换<code>ADMIN_PASS</code>为您<code>admin</code>在Identity服务中为用户选择的密码。</p>
</li>
<li><p>创建和编辑<code>demo-openrc</code>文件并添加以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">export OS_USER_DOMAIN_NAME=Default</span><br><span class="line">export OS_PROJECT_NAME=myproject</span><br><span class="line">export OS_USERNAME=myuser</span><br><span class="line">export OS_PASSWORD=MYUSER_PASS</span><br><span class="line">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">export OS_IMAGE_API_VERSION=2</span><br></pre></td></tr></table></figure>

<p>替换<code>DEMO_PASS</code>为您<code>demo</code>在Identity服务中为用户选择的密码。</p>
</li>
</ol>
<h4 id="3-1-1-8-使用脚本"><a href="#3-1-1-8-使用脚本" class="headerlink" title="3.1.1.8 使用脚本"></a>3.1.1.8 使用脚本</h4><p>要将客户端作为特定项目和用户运行，只需在运行它们之前加载关联的客户端环境脚本即可。例如：</p>
<ol>
<li><p>加载<code>admin-openrc</code>文件以使用Identity服务的位置以及<code>admin</code>项目和用户凭据填充环境变量：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>请求身份验证令牌：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">openstack token issue</span><br><span class="line"></span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                           |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| expires    | 2019-07-18T04:27:59+0000                                        |</span><br><span class="line">| id         | gAAAAABdL-c_Q5A7MjnZek0qb9o8jdvSw2ljIKqyZp14dXwjRyNGQpJSiQSAvyZ |</span><br><span class="line">|            | E-WhjVPc9e1jTtjFKu3UjW_FAhs9ayNRHiNBLRAWdp_RY7Hsb5GHzOF8Q88r8qS |</span><br><span class="line">|            | R_k4-9wkAKDP7wwNWP5WZXOBNbl-GRfWqkYYdEEhrpbMywjUJbw-17vsk       |</span><br><span class="line">| project_id | ddab7b9e10d14c59a64143a8f04ac045                                |</span><br><span class="line">| user_id    |  835091030b714480b7ec1bbe9c3a9f15                               |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="3-2-映像服务"><a href="#3-2-映像服务" class="headerlink" title="3.2 映像服务"></a>3.2 映像服务</h2><h3 id="3-2-1-映像服务仅在控制节点运行"><a href="#3-2-1-映像服务仅在控制节点运行" class="headerlink" title="3.2.1 映像服务仅在控制节点运行"></a>3.2.1 映像服务仅在控制节点运行</h3><h4 id="3-2-1-1-先决条件"><a href="#3-2-1-1-先决条件" class="headerlink" title="3.2.1.1 先决条件"></a>3.2.1.1 先决条件</h4><ol>
<li><p>要创建数据库，请完成以下步骤：</p>
<p>使用数据库访问客户端以<code>root</code>用户身份连接到数据库服务器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br></pre></td></tr></table></figure>

<p>创建<code>glance</code>数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE glance;</span><br></pre></td></tr></table></figure>

<p>授予对<code>glance</code>数据库的适当访问权限：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' \</span><br><span class="line"> IDENTIFIED BY 'GLANCE_DBPASS';</span><br><span class="line">GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' \</span><br><span class="line"> IDENTIFIED BY 'GLANCE_DBPASS';</span><br></pre></td></tr></table></figure>

<p>替换<code>GLANCE_DBPASS</code>为合适的密码。</p>
<p>退出数据库访问客户端。</p>
</li>
<li><p>来源<code>admin</code>凭据来访问仅管理员CLI命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>要创建服务凭据，请完成以下步骤：</p>
<p>创建<code>glance</code>用户：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">openstack user create --domain default --password-prompt glance</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | 5f9f2a8cb21f4116882df5d8f6ddc529 |</span><br><span class="line">| name                | glance                           |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>将<code>admin</code>角色添加到<code>glance</code>用户和 <code>service</code>项目：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role add --project service --user glance admin</span><br></pre></td></tr></table></figure>

<p>创建<code>glance</code>服务实体：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">openstack service create --name glance \</span><br><span class="line"> --description "OpenStack Image" image</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Image                  |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | a76799e303334fb7baec59a104547e86 |</span><br><span class="line">| name        | glance                           |</span><br><span class="line">| type        | image                            |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol start="4">
<li><p>创建Image服务API端点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  image public http://controller:9292</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | b96227302a474289af3d47184e2682c1 |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | a76799e303334fb7baec59a104547e86 |</span><br><span class="line">| service_name | glance                           |</span><br><span class="line">| service_type | image                            |</span><br><span class="line">| url          | http://controller:9292           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  image internal http://controller:9292</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 2f5de2bd8fb84143a3370d7c0c6daf4e |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | a76799e303334fb7baec59a104547e86 |</span><br><span class="line">| service_name | glance                           |</span><br><span class="line">| service_type | image                            |</span><br><span class="line">| url          | http://controller:9292           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  image admin http://controller:9292</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 8b88c34bbaf34bda9856c6de2d9b31d6 |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | a76799e303334fb7baec59a104547e86 |</span><br><span class="line">| service_name | glance                           |</span><br><span class="line">| service_type | image                            |</span><br><span class="line">| url          | http://controller:9292           |</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="3-2-1-2-安装和配置组件"><a href="#3-2-1-2-安装和配置组件" class="headerlink" title="3.2.1.2 安装和配置组件"></a>3.2.1.2 安装和配置组件</h4><ol>
<li><p>安装包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install glance</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>/etc/glance/glance-api.conf</code>文件并完成以下操作：</p>
<p>在该<code>[database]</code>部分中，配置数据库访问：</p>
<blockquote>
<p>[database]</p>
<p>connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance</p>
</blockquote>
<p>替换<code>GLANCE_DBPASS</code>为您为Image服务数据库选择的密码。</p>
<p>在<code>[keystone_authtoken]</code>和<code>[paste_deploy]</code>部分中，配置身份服务访问：</p>
<blockquote>
<p>[keystone_authtoken]</p>
<p>www_authenticate_uri = <a href="http://controller:5000" target="_blank" rel="noopener">http://controller:5000</a><br>auth_url = <a href="http://controller:5000" target="_blank" rel="noopener">http://controller:5000</a><br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = glance<br>password = GLANCE_PASS</p>
<p>[paste_deploy]</p>
<p>flavor = keystone</p>
</blockquote>
<p>替换<code>GLANCE_PASS</code>为您<code>glance</code>在Identity服务中为用户选择的密码 。<br>注意，注释掉或删除该<code>[keystone_authtoken]</code>部分中的任何其他选项 。</p>
<p>在该<code>[glance_store]</code>部分中，配置本地文件系统存储和映像文件的位置：</p>
<blockquote>
<p>[glance_store]</p>
<p>stores = file,http<br>default_store = file<br>filesystem_store_datadir = /var/lib/glance/images/</p>
</blockquote>
</li>
<li><p>编辑<code>/etc/glance/glance-registry.conf</code>文件并完成以下操作：<br>在该<code>[database]</code>部分中，配置数据库访问：</p>
<blockquote>
<p>[database]</p>
<p>connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance</p>
</blockquote>
<p>替换<code>GLANCE_DBPASS</code>为您为Image服务数据库选择的密码。</p>
<p>在<code>[keystone_authtoken]</code>和<code>[paste_deploy]</code>部分中，配置身份服务访问：</p>
<blockquote>
<p>[keystone_authtoken]</p>
<p>www_authenticate_uri = <a href="http://controller:5000" target="_blank" rel="noopener">http://controller:5000</a><br>auth_url = <a href="http://controller:5000" target="_blank" rel="noopener">http://controller:5000</a><br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = glance<br>password = GLANCE_PASS</p>
<p>[paste_deploy]<br>flavor = keystone</p>
</blockquote>
<p>替换<code>GLANCE_PASS</code>为您<code>glance</code>在Identity服务中为用户选择的密码 。<br>注意,注释掉或删除该<code>[keystone_authtoken]</code>部分中的任何其他选项 。</p>
</li>
<li><p>填充Image服务数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c "glance-manage db_sync" glance</span><br></pre></td></tr></table></figure>

<p>注意,忽略此输出中的任何弃用消息。</p>
</li>
</ol>
<h4 id="3-2-1-3-完成安装"><a href="#3-2-1-3-完成安装" class="headerlink" title="3.2.1.3 完成安装"></a>3.2.1.3 完成安装</h4><p>重启Image服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service glance-registry restart #此行报错没有此服务，下面的验证操作也没问题，怀疑没有需要运行此行</span><br><span class="line">service glance-api restart</span><br></pre></td></tr></table></figure>

<h4 id="3-2-1-4-验证操作"><a href="#3-2-1-4-验证操作" class="headerlink" title="3.2.1.4 验证操作"></a>3.2.1.4 验证操作</h4><ol>
<li><p>来源<code>admin</code>凭据来访问仅管理员CLI命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载源图像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<a href="https://docs.openstack.org/glance/stein/glossary.html#term-qemu-copy-on-write-2-qcow2" target="_blank" rel="noopener">QCOW2</a>磁盘格式，<a href="https://docs.openstack.org/glance/stein/glossary.html#term-bare" target="_blank" rel="noopener">裸</a> 容器格式和公共可见性将映像上载到映像服务 ，以便所有项目都可以访问它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">openstack image create &quot;cirros&quot; \</span><br><span class="line">  --file cirros-0.4.0-x86_64-disk.img \</span><br><span class="line">  --disk-format qcow2 --container-format bare \</span><br><span class="line">  --public</span><br><span class="line">#输出</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| checksum         | 443b7623e27ecf03dc9e01ee93f67afe                     |</span><br><span class="line">| container_format | bare                                                 |</span><br><span class="line">| created_at       | 2019-07-18T03:52:36Z                                 |</span><br><span class="line">| disk_format      | qcow2                                                |</span><br><span class="line">| file             | /v2/images/643f8b18-6272-4333-9983-0fb650ebf0c9/file |</span><br><span class="line">| id               | 643f8b18-6272-4333-9983-0fb650ebf0c9                 |</span><br><span class="line">| min_disk         | 0                                                    |</span><br><span class="line">| min_ram          | 0                                                    |</span><br><span class="line">| name             | cirros                                               |</span><br><span class="line">| owner            | ddab7b9e10d14c59a64143a8f04ac045                     |</span><br><span class="line">| protected        | os_hash_algo=&apos;sha512&apos;, os_hash_value=&apos;6513f21e44aa3d |</span><br><span class="line">|                  | a349f248188a44bc304a3653a04122d8fb4535423c8e1d14cd6a |</span><br><span class="line">|                  | 153f735bb0982e2161b5b5186106570c17a9e58b64dd39390617 |</span><br><span class="line">|                  | cd5a350f78&apos;, os_hidden=&apos;False&apos;                       |</span><br><span class="line">| schema           | /v2/schemas/image                                    |</span><br><span class="line">| size             | 12716032                                             |</span><br><span class="line">| status           | active                                               |</span><br><span class="line">| tags             |                                                      |</span><br><span class="line">| updated_at       | 2019-07-18T03:52:36Z                                 |</span><br><span class="line">| virtual_size     | None                                                 |</span><br><span class="line">| visibility       | public                                               |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>有关信息<strong>OpenStack的图像创建</strong>参数，请参阅 <a href="https://docs.openstack.org/user-guide/common/cli-manage-images.html#create-or-update-an-image-glance" target="_blank" rel="noopener">Create or update an image (glance)</a></p>
<p>有关磁盘和容器的图像格式的信息，请参阅 <a href="https://docs.openstack.org/image-guide/image-formats.html" target="_blank" rel="noopener">Disk and container formats for images</a></p>
<p>注意，OpenStack动态生成ID，因此您将在示例命令输出中看到不同的值。</p>
</li>
<li><p>确认上传图像并验证属性：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openstack image list</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| ID                                   | Name   | Status |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| 643f8b18-6272-4333-9983-0fb650ebf0c9 | cirros | active |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="3-3-安置服务"><a href="#3-3-安置服务" class="headerlink" title="3.3 安置服务"></a>3.3 安置服务</h2><h3 id="3-3-1-安置服务仅运行在控制节点"><a href="#3-3-1-安置服务仅运行在控制节点" class="headerlink" title="3.3.1 安置服务仅运行在控制节点"></a>3.3.1 安置服务仅运行在控制节点</h3><h4 id="3-3-1-1-先决条件"><a href="#3-3-1-1-先决条件" class="headerlink" title="3.3.1.1 先决条件"></a>3.3.1.1 先决条件</h4><p>在安装和配置放置服务之前，必须创建数据库，服务凭据和API端点。</p>
<h5 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h5><ol>
<li>要创建数据库，请完成以下步骤：<br>使用数据库访问客户端以<code>root</code>用户身份连接到数据库服务器：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br></pre></td></tr></table></figure>


</li>
</ol>
<p>   创建<code>placement</code>数据库：<br>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE placement;</span><br></pre></td></tr></table></figure></p>
<p>   授予对数据库的适当访问权限：<br>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON placement.* TO 'placement'@'localhost' \</span><br><span class="line">  IDENTIFIED BY 'PLACEMENT_DBPASS';</span><br><span class="line">GRANT ALL PRIVILEGES ON placement.* TO 'placement'@'%' \</span><br><span class="line">  IDENTIFIED BY 'PLACEMENT_DBPASS';</span><br></pre></td></tr></table></figure></p>
<p>   替换<code>PLACEMENT_DBPASS</code>为合适的密码。<br>   退出数据库访问客户端。</p>
<h5 id="配置用户和端点"><a href="#配置用户和端点" class="headerlink" title="配置用户和端点"></a>配置用户和端点</h5><ol>
<li><p>来源<code>admin</code>凭据来访问仅管理员CLI命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用您选择的创建Placement服务用户<code>PLACEMENT_PASS</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">openstack user create --domain default --password-prompt placement</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | 365658358d934c1e91f204ca14bcaee1 |</span><br><span class="line">| name                | placement                        |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用admin角色将Placement用户添加到服务项目：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role add --project service --user placement admin</span><br></pre></td></tr></table></figure>
</li>
<li><p>在服务目录中创建Placement API条目：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">openstack service create --name placement \</span><br><span class="line">  --description "Placement API" placement</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Placement API                    |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | d6988c6dc2bd4a03a50970585c2e342f |</span><br><span class="line">| name        | placement                        |</span><br><span class="line">| type        | placement                        |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建Placement API服务端点：<br>注意，根据您的环境，端点的URL将根据端口（可能是8780而不是8778，或根本没有端口）和主机名而有所不同。您有责任确定正确的URL。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  placement public http://controller:8778</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | cba1769b76cc4abab3f19b61ad3c7513 |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | d6988c6dc2bd4a03a50970585c2e342f |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http://controller:8778           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">  </span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  placement internal http://controller:8778</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | bd6c0ea2b16343c7a595dcd42a3b6153 |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | d6988c6dc2bd4a03a50970585c2e342f |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http://controller:8778           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">  </span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  placement admin http://controller:8778</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | f37fe946cc0b45d280893d4a47e1eacc |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | d6988c6dc2bd4a03a50970585c2e342f |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http://controller:8778           |</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="3-3-1-2-安装和配置组件"><a href="#3-3-1-2-安装和配置组件" class="headerlink" title="3.3.1.2 安装和配置组件"></a>3.3.1.2 安装和配置组件</h4><ol>
<li><p>安装包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install placement-api</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>/etc/placement/placement.conf</code>文件并完成以下操作：</p>
<p>在该<code>[placement_database]</code>部分中，配置数据库访问：</p>
<blockquote>
<p>[placement_database]</p>
<p>connection = mysql+pymysql://placement:PLACEMENT_DBPASS@controller/placement</p>
</blockquote>
<p>替换<code>PLACEMENT_DBPASS</code>为您为放置数据库选择的密码。</p>
<p>在<code>[api]</code>和<code>[keystone_authtoken]</code>部分中，配置身份服务访问：</p>
<blockquote>
<p>[api]</p>
<p>auth_strategy = keystone</p>
<p>[keystone_authtoken]</p>
<p>auth_url = <a href="http://controller:5000/v3" target="_blank" rel="noopener">http://controller:5000/v3</a><br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>project_name = service<br>username = placement<br>password = PLACEMENT_PASS</p>
</blockquote>
</li>
</ol>
<p>替换<code>PLACEMENT_PASS</code>为您<code>placement</code>在Identity服务中为用户选择的密码 。<br>   注意，注释掉或删除该<code>[keystone_authtoken]</code> 部分中的任何其他选项。</p>
<ol start="3">
<li><p>填充<code>placement</code>数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c &quot;placement-manage db sync&quot; placement</span><br></pre></td></tr></table></figure>

<p>注意，忽略此输出中的任何弃用消息。</p>
</li>
</ol>
<h4 id="3-3-1-3-完成安装"><a href="#3-3-1-3-完成安装" class="headerlink" title="3.3.1.3 完成安装"></a>3.3.1.3 完成安装</h4><p>重新加载Web服务器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service apache2 restart</span><br></pre></td></tr></table></figure>

<h4 id="3-3-1-4-验证安装"><a href="#3-3-1-4-验证安装" class="headerlink" title="3.3.1.4 验证安装"></a>3.3.1.4 验证安装</h4><ol>
<li><p>来源<code>admin</code>凭据来访问仅管理员CLI命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行状态检查以确保一切正常：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">placement-status upgrade check #这里需要sudo，不然可能出不来正确结果</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+----------------------------------+</span><br><span class="line">| Upgrade Check Results            |</span><br><span class="line">+----------------------------------+</span><br><span class="line">| Check: Missing Root Provider IDs |</span><br><span class="line">| Result: Success                  |</span><br><span class="line">| Details: None                    |</span><br><span class="line">+----------------------------------+</span><br><span class="line">| Check: Incomplete Consumers      |</span><br><span class="line">| Result: Success                  |</span><br><span class="line">| Details: None                    |</span><br><span class="line">+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>该命令的输出因发布而异。有关详细信息，请参阅<a href="https://docs.openstack.org/placement/stein/cli/placement-status.html#placement-status-checks" target="_blank" rel="noopener">placement-status upgrade check</a> </p>
</li>
<li><p>针对展示位置API运行一些命令：<br>安装<a href="https://docs.openstack.org/osc-placement/latest/" target="_blank" rel="noopener">osc-placement</a>插件：<br>注意，此示例使用<a href="https://pypi.org/" target="_blank" rel="noopener">PyPI</a>和<a href="https://pypi.org/project/pip/" target="_blank" rel="noopener">pip</a>，但如果您使用的是分发包，则可以从其存储库中安装该包。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python-pip #ubuntu没这个插件也就算了，pip还得自己装</span><br><span class="line">pip install osc-placement</span><br></pre></td></tr></table></figure>



</li>
</ol>
<p>   列出可用的资源类和特征：</p>
   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">   openstack --os-placement-api-version 1.2 resource class list --sort-column name</span><br><span class="line"><span class="meta">   #</span>输出</span><br><span class="line">   openstack: '--os-placement-api-version 1.2 resource class list --sort-column name' is not an openstack command. See 'openstack --help'.</span><br><span class="line">Did you mean one of these?</span><br><span class="line">    orchestration build info</span><br><span class="line">    orchestration resource type list</span><br><span class="line">    orchestration resource type show</span><br><span class="line">    orchestration service list</span><br><span class="line">    orchestration template function list</span><br><span class="line">    orchestration template validate</span><br><span class="line">    orchestration template version list</span><br><span class="line"><span class="meta">   #</span>而不是下面的输出</span><br><span class="line">     +----------------------------+</span><br><span class="line">     | name                       |</span><br><span class="line">     +----------------------------+</span><br><span class="line">     | DISK_GB                    |</span><br><span class="line">     | IPV4_ADDRESS               |</span><br><span class="line">     | ...                        |</span><br><span class="line">     </span><br><span class="line">    openstack --os-placement-api-version 1.6 trait list --sort-column name</span><br><span class="line"><span class="meta">   #</span>输出</span><br><span class="line">   openstack: '--os-placement-api-version 1.6 trait list --sort-column name' is not an openstack command. See 'openstack --help'.</span><br><span class="line">   Did you mean one of these?</span><br><span class="line">     application credential create</span><br><span class="line">     application credential delete</span><br><span class="line">     application credential list</span><br><span class="line">     application credential show</span><br><span class="line">     configuration show</span><br><span class="line"><span class="meta">   #</span>而不是下面的输出</span><br><span class="line">     +---------------------------------------+</span><br><span class="line">     | name                                  |</span><br><span class="line">     +---------------------------------------+</span><br><span class="line">     | COMPUTE_DEVICE_TAGGING                |</span><br><span class="line">     | COMPUTE_NET_ATTACH_INTERFACE          |</span><br><span class="line">     | ...                                   |</span><br></pre></td></tr></table></figure>

<h2 id="3-4-计算服务"><a href="#3-4-计算服务" class="headerlink" title="3.4 计算服务"></a>3.4 计算服务</h2><h3 id="3-4-1-安装和配置控制节点"><a href="#3-4-1-安装和配置控制节点" class="headerlink" title="3.4.1 安装和配置控制节点"></a>3.4.1 安装和配置控制节点</h3><h4 id="3-4-1-1-先决条件"><a href="#3-4-1-1-先决条件" class="headerlink" title="3.4.1.1 先决条件"></a>3.4.1.1 先决条件</h4><ol>
<li><p>要创建数据库，请完成以下步骤：</p>
<p>使用数据库访问客户端以<code>root</code>用户身份连接到数据库服务器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br></pre></td></tr></table></figure>

<p>创建<code>nova_api</code>，<code>nova</code>和<code>nova_cell0</code>数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE nova_api;</span><br><span class="line">CREATE DATABASE nova;</span><br><span class="line">CREATE DATABASE nova_cell0;</span><br></pre></td></tr></table></figure>

<p>授予对数据库的适当访问权限：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'localhost' \</span><br><span class="line">    IDENTIFIED BY 'NOVA_DBPASS';</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'%' \</span><br><span class="line">    IDENTIFIED BY 'NOVA_DBPASS';</span><br><span class="line">  </span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' \</span><br><span class="line">    IDENTIFIED BY 'NOVA_DBPASS';</span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' \</span><br><span class="line">    IDENTIFIED BY 'NOVA_DBPASS';</span><br><span class="line">  </span><br><span class="line">GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'localhost' \</span><br><span class="line">    IDENTIFIED BY 'NOVA_DBPASS';</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'%' \</span><br><span class="line">    IDENTIFIED BY 'NOVA_DBPASS';</span><br></pre></td></tr></table></figure>

<p>  替换<code>NOVA_DBPASS</code>为合适的密码。</p>
<p>退出数据库访问客户端。</p>
</li>
<li><p>来源<code>admin</code>凭据来访问仅管理员CLI命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建Compute服务凭据：</p>
<p>创建<code>nova</code>用户：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">openstack user create --domain default --password-prompt nova</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | 83842db153d34caebf79ac9e6a38196e |</span><br><span class="line">| name                | nova                             |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>将<code>admin</code>角色添加到<code>nova</code>用户：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role add --project service --user nova admin</span><br></pre></td></tr></table></figure>

<p>创建<code>nova</code>服务实体：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">openstack service create --name nova \</span><br><span class="line">  --description "OpenStack Compute" compute</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Compute                |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 6a65433a36d54660a41a39d1aa37fca9 |</span><br><span class="line">| name        | nova                             |</span><br><span class="line">| type        | compute                          |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建Compute API服务端点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  compute public http://controller:8774/v2.1</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | fcdb5eae3e144778b72e4810372a94f0 |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | 6a65433a36d54660a41a39d1aa37fca9 |</span><br><span class="line">| service_name | nova                             |</span><br><span class="line">| service_type | compute                          |</span><br><span class="line">| url          | http://controller:8774/v2.1      |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  compute internal http://controller:8774/v2.1</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | a5721cd78b2f4c7a8b8f52f50d5213f3 |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | 6a65433a36d54660a41a39d1aa37fca9 |</span><br><span class="line">| service_name | nova                             |</span><br><span class="line">| service_type | compute                          |</span><br><span class="line">| url          | http://controller:8774/v2.1      |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  compute admin http://controller:8774/v2.1</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | f08c35a57bb7492f875eed0be5759bbf |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | 6a65433a36d54660a41a39d1aa37fca9 |</span><br><span class="line">| service_name | nova                             |</span><br><span class="line">| service_type | compute                          |</span><br><span class="line">| url          | http://controller:8774/v2.1      |</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h4 id="3-4-1-2-安装和配置组件"><a href="#3-4-1-2-安装和配置组件" class="headerlink" title="3.4.1.2 安装和配置组件"></a>3.4.1.2 安装和配置组件</h4><ol>
<li><p>安装包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nova-api nova-conductor \</span><br><span class="line">  nova-novncproxy nova-scheduler</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>/etc/nova/nova.conf</code>文件并完成以下操作：<br>在<code>[api_database]</code>和<code>[database]</code>部分中，配置数据库访问：</p>
<blockquote>
<p>[api_database]</p>
<p>connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api</p>
<p>[database]</p>
<p>connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova</p>
</blockquote>
<p>替换<code>NOVA_DBPASS</code>为您为Compute数据库选择的密码。</p>
<p>在该<code>[DEFAULT]</code>部分中，配置<code>RabbitMQ</code>消息队列访问：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>transport_url = rabbit://openstack:RABBIT_PASS@controller</p>
</blockquote>
<p>替换<code>RABBIT_PASS</code>为您为<code>openstack</code> 帐户选择的密码<code>RabbitMQ</code>。</p>
<p>在<code>[api]</code>和<code>[keystone_authtoken]</code>部分中，配置身份服务访问：</p>
<blockquote>
<p>[api]</p>
<p>auth_strategy = keystone</p>
<p>[keystone_authtoken]</p>
<p>auth_url = <a href="http://controller:5000/v3" target="_blank" rel="noopener">http://controller:5000/v3</a><br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = nova<br>password = NOVA_PASS</p>
</blockquote>
<p>替换<code>NOVA_PASS</code>为您<code>nova</code>在Identity服务中为用户选择的密码。<br>注意，注释掉或删除该<code>[keystone_authtoken]</code> 部分中的任何其他选项。</p>
<p>在该<code>[DEFAULT]</code>部分中，配置<code>my_ip</code>选项以使用控制器节点的管理接口IP地址：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>my_ip = 192.168.2.50</p>
</blockquote>
<p>在该<code>[DEFAULT]</code>部分中，启用对网络服务的支持：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>use_neutron = true<br>firewall_driver = nova.virt.firewall.NoopFirewallDriver</p>
</blockquote>
<p>注意，默认情况下，Compute使用内部防火墙驱动程序。由于Networking服务包含防火墙驱动程序，因此必须使用<code>nova.virt.firewall.NoopFirewallDriver</code>防火墙驱动程序禁用Compute防火墙驱动 程序。</p>
<p>配置<strong>/etc/nova/nova.conf</strong>的<code>[neutron]</code>部分。 有关更多信息，请参阅<a href="https://docs.openstack.org/neutron/stein/install/controller-install-ubuntu.html#configure-the-compute-service-to-use-the-networking-service" target="_blank" rel="noopener">网络服务安装指南</a>。</p>
<p>在该<code>[vnc]</code>部分中，配置VNC代理以使用控制器节点的管理接口IP地址：</p>
<blockquote>
<p>[vnc]<br>enabled = true</p>
<p>server_listen = $my_ip<br>server_proxyclient_address = $my_ip</p>
</blockquote>
<p>在该<code>[glance]</code>部分中，配置Image服务API的位置：</p>
<blockquote>
<p>[glance]</p>
<p>api_servers = <a href="http://controller:9292" target="_blank" rel="noopener">http://controller:9292</a></p>
</blockquote>
<p>在该<code>[oslo_concurrency]</code>部分中，配置锁定路径：</p>
<blockquote>
<p>[oslo_concurrency]</p>
<p>lock_path = /var/lib/nova/tmp</p>
</blockquote>
<p>由于包装错误，请从<code>[DEFAULT]</code>部分中删除<code>log_dir</code>选项 。<br>在该<code>[placement]</code>部分中，配置对Placement服务的访问权限：</p>
<blockquote>
<p>[placement]</p>
<p>region_name = RegionOne<br>project_domain_name = Default<br>project_name = service<br>auth_type = password<br>user_domain_name = Default<br>auth_url = <a href="http://controller:5000/v3" target="_blank" rel="noopener">http://controller:5000/v3</a><br>username = placement<br>password = PLACEMENT_PASS</p>
</blockquote>
</li>
</ol>
<p>替换<code>PLACEMENT_PASS</code>为您<code>placement</code>在安装<a href="https://docs.openstack.org/placement/stein/install/" target="_blank" rel="noopener">Placement</a>时为服务用户 选择的密码 。注释掉或删除该<code>[placement]</code>部分中的任何其他选项。</p>
<ol start="3">
<li><p>填充<code>nova-api</code>数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c "nova-manage api_db sync" nova</span><br></pre></td></tr></table></figure>

<p>注意，忽略此输出中的任何弃用消息。</p>
</li>
<li><p>注册<code>cell0</code>数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c "nova-manage cell_v2 map_cell0" nova</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建<code>cell1</code>单元格：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c "nova-manage cell_v2 create_cell --name=cell1 --verbose" nova</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">245a3d9b-1074-487a-bbe9-8b1baa634a9e</span><br></pre></td></tr></table></figure>
</li>
<li><p>填充新星数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c "nova-manage db sync" nova</span><br></pre></td></tr></table></figure>
</li>
<li><p>验证nova cell0和cell1是否正确注册：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c "nova-manage cell_v2 list_cells" nova</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+-------+--------------------------------------+右边还有3栏，放不下</span><br><span class="line">| Name  | UUID                                 |</span><br><span class="line">+-------+--------------------------------------+</span><br><span class="line">| cell0 | 00000000-0000-0000-0000-000000000000 |</span><br><span class="line">| cell1 | 245a3d9b-1074-487a-bbe9-8b1baa634a9e |</span><br><span class="line">+-------+--------------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="3-4-1-3-完成安装"><a href="#3-4-1-3-完成安装" class="headerlink" title="3.4.1.3 完成安装"></a>3.4.1.3 完成安装</h4><p>重启Compute服务：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service nova-api restart</span><br><span class="line">service nova-scheduler restart</span><br><span class="line">service nova-conductor restart</span><br><span class="line">service nova-novncproxy restart</span><br></pre></td></tr></table></figure>

<h3 id="3-4-2-安装并配置计算节点"><a href="#3-4-2-安装并配置计算节点" class="headerlink" title="3.4.2 安装并配置计算节点"></a>3.4.2 安装并配置计算节点</h3><h4 id="3-4-2-1-安装和配置组件"><a href="#3-4-2-1-安装和配置组件" class="headerlink" title="3.4.2.1 安装和配置组件"></a>3.4.2.1 安装和配置组件</h4><ol>
<li><p>安装包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nova-compute</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>/etc/nova/nova.conf</code>文件并完成以下操作：<br>在该<code>[DEFAULT]</code>部分中，配置<code>RabbitMQ</code>消息队列访问：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>transport_url = rabbit://openstack:RABBIT_PASS@controller</p>
</blockquote>
<p>替换<code>RABBIT_PASS</code>为您为<code>openstack</code> 帐户选择的密码<code>RabbitMQ</code>。</p>
<p>在<code>[api]</code>和<code>[keystone_authtoken]</code>部分中，配置身份服务访问：</p>
<blockquote>
<p>[api]</p>
<p>auth_strategy = keystone</p>
<p>[keystone_authtoken]</p>
<p>auth_url = <a href="http://controller:5000/v3" target="_blank" rel="noopener">http://controller:5000/v3</a><br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = nova<br>password = NOVA_PASS</p>
</blockquote>
<p>替换<code>NOVA_PASS</code>为您<code>nova</code>在Identity服务中为用户选择的密码。<br>注意,注释掉或删除该<code>[keystone_authtoken]</code>部分中的任何其他选项 。</p>
<p>在该<code>[DEFAULT]</code>部分中，配置<code>my_ip</code>选项：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>my_ip = 192.168.2.51</p>
</blockquote>
<p>在该<code>[DEFAULT]</code>部分中，启用对网络服务的支持：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>use_neutron = true<br>firewall_driver = nova.virt.firewall.NoopFirewallDriver</p>
</blockquote>
</li>
</ol>
<p>注意,默认情况下，Compute使用内部防火墙服务。由于Networking包含防火墙服务，因此必须使用<code>nova.virt.firewall.NoopFirewallDriver</code>防火墙驱动程序禁用Compute防火墙服务。</p>
<p>配置<strong>/etc/nova/nova.conf</strong>的<code>[neutron]</code>部分。 有关更多详细信息，请参阅<a href="https://docs.openstack.org/neutron/stein/install/compute-install-ubuntu.html#configure-the-compute-service-to-use-the-networking-service" target="_blank" rel="noopener">网络服务安装指南</a>。</p>
<p>在该<code>[vnc]</code>部分中，启用并配置远程控制台访问：</p>
<blockquote>
<p>[vnc]</p>
<p>enabled = true<br>server_listen = 0.0.0.0<br>server_proxyclient_address = $my_ip<br>novncproxy_base_url = <a href="http://controller:6080/vnc_auto.html" target="_blank" rel="noopener">http://controller:6080/vnc_auto.html</a></p>
</blockquote>
<p>服务器组件侦听所有IP地址，并且代理组件仅侦听计算节点的管理接口IP地址。基本URL指示您可以使用Web浏览器访问此计算节点上的实例的远程控制台的位置。</p>
<p>注意,如果要访问远程控制台的Web浏览器驻留在无法解析<code>controller</code>主机名的主机上，则必须<code>controller</code>使用控制器节点的管理接口IP地址替换 。</p>
<p>在该<code>[glance]</code>部分中，配置Image服务API的位置：</p>
<blockquote>
<p>[glance]</p>
<p>api_servers = <a href="http://controller:9292" target="_blank" rel="noopener">http://controller:9292</a></p>
</blockquote>
<p>在该<code>[oslo_concurrency]</code>部分中，配置锁定路径：</p>
<blockquote>
<p>[oslo_concurrency]</p>
<p>lock_path = /var/lib/nova/tmp</p>
</blockquote>
<p>在该<code>[placement]</code>部分中，配置Placement API：</p>
<blockquote>
<p>[placement]</p>
<p>region_name = RegionOne<br>project_domain_name = Default<br>project_name = service<br>auth_type = password<br>user_domain_name = Default<br>auth_url = <a href="http://controller:5000/v3" target="_blank" rel="noopener">http://controller:5000/v3</a><br>username = placement<br>password = PLACEMENT_PASS</p>
</blockquote>
<p>替换<code>PLACEMENT_PASS</code>为您<code>placement</code>在Identity服务中为用户选择的密码 。注释掉该<code>[placement]</code>部分中的任何其他选项。</p>
<h4 id="3-4-2-2-完成安装"><a href="#3-4-2-2-完成安装" class="headerlink" title="3.4.2.2 完成安装"></a>3.4.2.2 完成安装</h4><ol>
<li><p>确定您的计算节点是否支持虚拟机的硬件加速：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep -c '(vmx|svm)' /proc/cpuinfo</span><br></pre></td></tr></table></figure>

<p>如果此命令返回值是<code>1</code>或更高，则计算节点支持硬件加速，通常不需要其他配置。</p>
<p>如果此命令返回值<code>0</code>，则您的计算节点不支持硬件加速，您必须配置<code>libvirt</code>为使用QEMU而不是KVM。</p>
<p>编辑文件中的<code>[libvirt]</code>部分，<code>/etc/nova/nova-compute.conf</code>如下所示：</p>
<blockquote>
<p>[libvirt]</p>
<p>virt_type = qemu</p>
</blockquote>
</li>
<li><p>重新启动Compute服务：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nova-compute restart</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="3-4-3-到控制节点将计算节点添加到单元数据库"><a href="#3-4-3-到控制节点将计算节点添加到单元数据库" class="headerlink" title="3.4.3 到控制节点将计算节点添加到单元数据库"></a>3.4.3 到控制节点将计算节点添加到单元数据库</h3><ol>
<li><p>获取管理员凭据以启用仅管理员CLI命令，然后确认数据库中是否存在计算主机：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">source admin-openrc</span><br><span class="line">openstack compute service list --service nova-compute</span><br><span class="line"><span class="meta">#</span>输出 </span><br><span class="line">+----+--------------+----------+------+---------+-------+----------------------------+</span><br><span class="line">| ID | Binary       | Host     | Zone | Status  | State | Updated At                 |</span><br><span class="line">+----+--------------+----------+------+---------+-------+----------------------------+</span><br><span class="line">|  8 | nova-compute | compute1 | nova | enabled | up    | 2019-07-19T08:22:57.000000 |</span><br><span class="line">+----+--------------+----------+------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>发现计算主机：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c "nova-manage cell_v2 discover_hosts --verbose" nova</span><br><span class="line"><span class="meta">#</span>输出 #也有可能不一样，我后来复查了这里，所以我这里可能不是新装的样子</span><br><span class="line">Found 2 cell mappings.</span><br><span class="line">Skipping cell0 since it does not contain hosts.</span><br><span class="line">Getting computes from cell 'cell1': 245a3d9b-1074-487a-bbe9-8b1baa634a9e</span><br><span class="line">Found 0 unmapped computes in cell: 245a3d9b-1074-487a-bbe9-8b1baa634a9e</span><br></pre></td></tr></table></figure>


</li>
</ol>
<p>   注意,添加新计算节点时，必须在控制器节点上运行<code>nova-manage cell_v2 discover_hosts</code> 以注册这些新计算节点。或者，您可以在以下位置设置适当的间隔 ：<code>/etc/nova/nova.conf</code></p>
<blockquote>
<p>[scheduler]<br>discover_hosts_in_cells_interval = 300</p>
</blockquote>
<h3 id="3-4-4-验证操作"><a href="#3-4-4-验证操作" class="headerlink" title="3.4.4 验证操作"></a>3.4.4 验证操作</h3><h4 id="3-4-4-1-验证操作仅需在控制节点运行"><a href="#3-4-4-1-验证操作仅需在控制节点运行" class="headerlink" title="3.4.4.1 验证操作仅需在控制节点运行"></a>3.4.4.1 验证操作仅需在控制节点运行</h4><ol>
<li><p>来源<code>admin</code>凭据来访问仅管理员CLI命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>列出服务组件以验证每个进程的成功启动和注册：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">openstack compute service list</span><br><span class="line"><span class="meta">#</span>输出   #最后一栏受限于文章宽度，省略了时间</span><br><span class="line">+----+----------------+------------+----------+---------+-------+--------------+</span><br><span class="line">| ID | Binary         | Host       | Zone     | Status  | State | Updated At   |</span><br><span class="line">+----+----------------+------------+----------+---------+-------+--------------+</span><br><span class="line">|  1 | nova-scheduler | controller | internal | enabled | up    | 2019-07-19 --|</span><br><span class="line">|  7 | nova-conductor | controller | internal | enabled | up    | 2019-07-19 --|</span><br><span class="line">|  8 | nova-compute   | compute1   | nova     | enabled | up    | 2019-07-19 --|</span><br><span class="line">+----+----------------+------------+----------+---------+-------+--------------+</span><br></pre></td></tr></table></figure>

<p>注意，此输出应指示在控制器节点上启用的两个服务组件以及在计算节点上启用的一个服务组件。</p>
</li>
<li><p>列出Identity服务中的API端点以验证与Identity服务的连接：</p>
<p>注意，端点列表可能会有所不同，具体取决于OpenStack组件的安装。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">openstack catalog list</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">| Name      | Type      | Endpoints                               |</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">| nova      | compute   | RegionOne                               |</span><br><span class="line">|           |           |   internal: http://controller:8774/v2.1 |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   admin: http://controller:8774/v2.1    |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   public: http://controller:8774/v2.1   |</span><br><span class="line">|           |           |                                         |</span><br><span class="line">| glance    | image     | RegionOne                               |</span><br><span class="line">|           |           |   internal: http://controller:9292      |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   admin: http://controller:9292         |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   public: http://controller:9292        |</span><br><span class="line">|           |           |                                         |</span><br><span class="line">| placement | placement | RegionOne                               |</span><br><span class="line">|           |           |   internal: http://controller:8778      |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   public: http://controller:8778        |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   admin: http://controller:8778         |</span><br><span class="line">|           |           |                                         |</span><br><span class="line">| keystone  | identity  | RegionOne                               |</span><br><span class="line">|           |           |   public: http://controller:5000/v3/    |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   admin: http://controller:5000/v3/     |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   internal: http://controller:5000/v3/  |</span><br><span class="line">|           |           |                                         |</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br></pre></td></tr></table></figure>

<p>注意，忽略此输出中的任何警告。</p>
</li>
<li><p>列出Image服务中的图像以验证与Image服务的连接：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openstack image list</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| ID                                   | Name   | Status |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| 643f8b18-6272-4333-9983-0fb650ebf0c9 | cirros | active |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查单元格和放置API是否正常运行以及其他必要的先决条件是否到位：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">nova-status upgrade check</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------------------------------------------------------------+</span><br><span class="line">| Upgrade Check Results                                              |</span><br><span class="line">+--------------------------------------------------------------------+</span><br><span class="line">| Check: Cells v2                                                    |</span><br><span class="line">| Result: Success                                                    |</span><br><span class="line">| Details: No host mappings or compute nodes were found. Remember to |</span><br><span class="line">|   run command 'nova-manage cell_v2 discover_hosts' when new        |</span><br><span class="line">|   compute hosts are deployed.                                      |</span><br><span class="line">+--------------------------------------------------------------------+</span><br><span class="line">| Check: Placement API                                               |</span><br><span class="line">| Result: Success                                                    |</span><br><span class="line">| Details: None                                                      |</span><br><span class="line">+--------------------------------------------------------------------+</span><br><span class="line">| Check: Ironic Flavor Migration                                     |</span><br><span class="line">| Result: Success                                                    |</span><br><span class="line">| Details: None                                                      |</span><br><span class="line">+--------------------------------------------------------------------+</span><br><span class="line">| Check: Request Spec Migration                                      |</span><br><span class="line">| Result: Success                                                    |</span><br><span class="line">| Details: None                                                      |</span><br><span class="line">+--------------------------------------------------------------------+</span><br><span class="line">| Check: Console Auths                                               |</span><br><span class="line">| Result: Success                                                    |</span><br><span class="line">| Details: None                                                      |</span><br><span class="line">+--------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="3-5-网络服务"><a href="#3-5-网络服务" class="headerlink" title="3.5 网络服务"></a>3.5 网络服务</h2><p><strong>重新配置网络接口将中断网络连接，因此建议使用本地终端会话来执行这些过程。</strong></p>
<h3 id="3-5-1-主机网络"><a href="#3-5-1-主机网络" class="headerlink" title="3.5.1 主机网络"></a>3.5.1 主机网络</h3><p>emmm。。。这部分重复了一下标题1.1-1.3的内容，就不说了</p>
<h3 id="3-5-2-安装和配置控制节点"><a href="#3-5-2-安装和配置控制节点" class="headerlink" title="3.5.2 安装和配置控制节点"></a>3.5.2 安装和配置控制节点</h3><h4 id="3-5-2-1-先决条件"><a href="#3-5-2-1-先决条件" class="headerlink" title="3.5.2.1 先决条件"></a>3.5.2.1 先决条件</h4><p>在配置OpenStack Networking（neutron）服务之前，必须创建数据库，服务凭据和API端点。</p>
<ol>
<li><p>要创建数据库，请完成以下步骤：</p>
<p>使用数据库访问客户端以<code>root</code>用户身份连接到数据库服务器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>

<p>创建<code>neutron</code>数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE neutron;</span><br></pre></td></tr></table></figure>

<p>授予对<code>neutron</code>数据库的适当访问权限，替换 <code>NEUTRON_DBPASS</code>为合适的密码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' \</span><br><span class="line">  IDENTIFIED BY 'NEUTRON_DBPASS';</span><br><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'%' \</span><br><span class="line">  IDENTIFIED BY 'NEUTRON_DBPASS';</span><br></pre></td></tr></table></figure>

<p>退出数据库访问客户端。</p>
</li>
<li><p>来源<code>admin</code>凭据来访问仅管理员CLI命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source admin-openrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>要创建服务凭据，请完成以下步骤：</p>
<p>创建<code>neutron</code>用户：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">openstack user create --domain default --password-prompt neutron</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | e195545b47324d1fb56c81cd80561d11 |</span><br><span class="line">| name                | neutron                          |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>将<code>admin</code>角色添加到<code>neutron</code>用户：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role add --project service --user neutron admin</span><br></pre></td></tr></table></figure>

<p>注意，此命令不提供输出。</p>
<p>创建<code>neutron</code>服务实体：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">openstack service create --name neutron \</span><br><span class="line">     --description "OpenStack Networking" network</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">   +-------------+----------------------------------+</span><br><span class="line">   | Field       | Value                            |</span><br><span class="line">   +-------------+----------------------------------+</span><br><span class="line">   | description | OpenStack Networking             |</span><br><span class="line">   | enabled     | True                             |</span><br><span class="line">   | id          | d819e88f42e642c8867c8db49e32c6ef |</span><br><span class="line">   | name        | neutron                          |</span><br><span class="line">   | type        | network                          |</span><br><span class="line">   +-------------+----------------------------------+</span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol start="4">
<li><p>创建网络服务API端点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  network public http://controller:9696</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | a925a892d81345689578481717a54d7e |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | d819e88f42e642c8867c8db49e32c6ef |</span><br><span class="line">| service_name | neutron                          |</span><br><span class="line">| service_type | network                          |</span><br><span class="line">| url          | http://controller:9696           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  network internal http://controller:9696</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 4d32d47c2fee4f2fa9b81f0a906a5d3c |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | d819e88f42e642c8867c8db49e32c6ef |</span><br><span class="line">| service_name | neutron                          |</span><br><span class="line">| service_type | network                          |</span><br><span class="line">| url          | http://controller:9696           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  network admin http://controller:9696</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | fcb3a04b0915449691dcff6eb2f3cf86 |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | d819e88f42e642c8867c8db49e32c6ef |</span><br><span class="line">| service_name | neutron                          |</span><br><span class="line">| service_type | network                          |</span><br><span class="line">| url          | http://controller:9696           |</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h5 id="配置网络选项"><a href="#配置网络选项" class="headerlink" title="配置网络选项"></a>配置网络选项</h5><p>您可以使用选项1和2表示的两种体系结构之一来部署网络服务。</p>
<p>选项1部署了最简单的架构，该架构仅支持将实例附加到提供商（外部）网络。没有自助（私有）网络，路由器或浮动IP地址。只有该<code>admin</code>特权用户或其他特权用户才能管理提供商网络。</p>
<p>选项2使用支持将实例附加到自助服务网络的第3层服务来增强选项1。该<code>demo</code>非特权用户或其他非特权用户可以管理自助服务网络，包括提供自助服务和提供商网络之间连接的路由器。此外，浮动IP地址提供与使用来自外部网络（如Internet）的自助服务网络的实例的连接。</p>
<p>自助服务网络通常使用覆盖网络。诸如VXLAN之类的覆盖网络协议包括额外的报头，这些报头增加了开销并减少了有效载荷或用户数据的可用空间。在不了解虚拟网络基础结构的情况下，实例尝试使用1500字节的默认以太网最大传输单元（MTU）来发送分组。Networking服务自动通过DHCP为实例提供正确的MTU值。但是，某些云映像不使用DHCP或忽略DHCP MTU选项，并且需要使用元数据或脚本进行配置。</p>
<p>注意，选项2还支持将实例附加到提供商网络。</p>
<p>选择以下网络选项之一以配置特定于其的服务。</p>
<p><a href="https://docs.openstack.org/neutron/stein/install/controller-install-option1-ubuntu.html" target="_blank" rel="noopener">网络选项1：提供商网络</a></p>
<p><a href="https://docs.openstack.org/neutron/stein/install/controller-install-option2-ubuntu.html" target="_blank" rel="noopener">网络选项2：自助服务网络</a></p>
<p><strong>我这里选择自助服务网络，功能更强大了，看起来也不是很复杂</strong></p>
<h5 id="安装组件"><a href="#安装组件" class="headerlink" title="安装组件"></a>安装组件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install neutron-server neutron-plugin-ml2 \</span><br><span class="line">  neutron-linuxbridge-agent neutron-l3-agent neutron-dhcp-agent \</span><br><span class="line">  neutron-metadata-agent</span><br></pre></td></tr></table></figure>

<h5 id="配置服务器组件"><a href="#配置服务器组件" class="headerlink" title="配置服务器组件"></a>配置服务器组件</h5><p>编辑<code>/etc/neutron/neutron.conf</code>文件并完成以下操作：</p>
<p>在该<code>[database]</code>部分中，配置数据库访问：</p>
<blockquote>
<p>[database]</p>
<p>connection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron</p>
</blockquote>
<p>替换<code>NEUTRON_DBPASS</code>为您为数据库选择的密码。</p>
<p>注意,注释掉或删除<code>[database]</code>部分中<code>connection</code>的任何其他选项 。</p>
<p>在该<code>[DEFAULT]</code>部分中，启用模块化第2层（ML2）插件，路由器服务和重叠的IP地址：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>core_plugin = ml2<br>service_plugins = router<br>allow_overlapping_ips = true</p>
</blockquote>
<p>在该<code>[DEFAULT]</code>部分中，配置<code>RabbitMQ</code> 消息队列访问：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>transport_url = rabbit://openstack:RABBIT_PASS@controller</p>
</blockquote>
<p>  替换<code>RABBIT_PASS</code>为您<code>openstack</code>在RabbitMQ中为帐户选择的密码 。</p>
<p>在<code>[DEFAULT]</code>和<code>[keystone_authtoken]</code>部分中，配置身份服务访问：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>auth_strategy = keystone</p>
<p>[keystone_authtoken]</p>
<p>www_authenticate_uri = <a href="http://controller:5000" target="_blank" rel="noopener">http://controller:5000</a><br>auth_url = <a href="http://controller:5000" target="_blank" rel="noopener">http://controller:5000</a><br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>project_name = service<br>username = neutron<br>password = NEUTRON_PASS</p>
</blockquote>
<p>替换<code>NEUTRON_PASS</code>为您<code>neutron</code> 在Identity服务中为用户选择的密码。<br>注意,注释掉或删除该<code>[keystone_authtoken]</code>部分中的任何其他选项 。</p>
<p>在<code>[DEFAULT]</code>和<code>[nova]</code>部分中，配置网络以通知Compute网络拓扑更改：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>notify_nova_on_port_status_changes = true<br>notify_nova_on_port_data_changes = true</p>
<p>[nova]</p>
<p>auth_url = <a href="http://controller:5000" target="_blank" rel="noopener">http://controller:5000</a><br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>region_name = RegionOne<br>project_name = service<br>username = nova<br>password = NOVA_PASS</p>
</blockquote>
<p>替换<code>NOVA_PASS</code>为您<code>nova</code> 在Identity服务中为用户选择的密码。</p>
<p>在该<code>[oslo_concurrency]</code>部分中，配置锁定路径：</p>
<blockquote>
<p>[oslo_concurrency]</p>
<p>lock_path = /var/lib/neutron/tmp</p>
</blockquote>
<h5 id="配置模块化第2层（ML2）插件¶"><a href="#配置模块化第2层（ML2）插件¶" class="headerlink" title="配置模块化第2层（ML2）插件¶"></a>配置模块化第2层（ML2）插件<a href="https://docs.openstack.org/neutron/stein/install/controller-install-option2-ubuntu.html#configure-the-modular-layer-2-ml2-plug-in" target="_blank" rel="noopener">¶</a></h5><p>ML2插件使用Linux桥接机制为实例构建第2层（桥接和交换）虚拟网络基础架构。</p>
<p>编辑<code>/etc/neutron/plugins/ml2/ml2_conf.ini</code>文件并完成以下操作：<br>在该<code>[ml2]</code>部分中，启用flat，VLAN和VXLAN网络：</p>
<blockquote>
<p>[ml2]</p>
<p>type_drivers = flat,vlan,vxlan</p>
</blockquote>
<p>在该<code>[ml2]</code>部分中，启用VXLAN自助服务网络：</p>
<blockquote>
<p>[ml2]</p>
<p>tenant_network_types = vxlan</p>
</blockquote>
<p>在该<code>[ml2]</code>部分中，启用Linux桥和第2层填充机制：</p>
<blockquote>
<p>[ml2]</p>
<p>mechanism_drivers = linuxbridge,l2population</p>
</blockquote>
<p>警告,配置ML2插件后，删除<code>type_drivers</code>选项中的值 可能会导致数据库不一致。<br>注意,Linux网桥代理仅支持VXLAN重叠网络。</p>
<p>在该<code>[ml2]</code>部分中，启用端口安全性扩展驱动程序：</p>
<blockquote>
<p>[ml2]</p>
<p>extension_drivers = port_security</p>
</blockquote>
<p>在该<code>[ml2_type_flat]</code>部分中，将提供商虚拟网络配置为扁平网络：</p>
<blockquote>
<p>[ml2_type_flat]</p>
<p>flat_networks = provider</p>
</blockquote>
<p>在该<code>[ml2_type_vxlan]</code>部分中，为自助服务网络配置VXLAN网络标识符范围：</p>
<blockquote>
<p>[ml2_type_vxlan]</p>
<p>vni_ranges = 1:1000</p>
</blockquote>
<p>在该<code>[securitygroup]</code>部分中，启用ipset以提高安全组规则的效率：</p>
<blockquote>
<p>[securitygroup]</p>
<p>enable_ipset = true</p>
</blockquote>
<h5 id="配置Linux桥代理"><a href="#配置Linux桥代理" class="headerlink" title="配置Linux桥代理"></a>配置Linux桥代理</h5><p>Linux网桥代理为实例构建第2层（桥接和交换）虚拟网络基础架构并处理安全组。</p>
<p>编辑<code>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</code>文件并完成以下操作：<br>在该<code>[linux_bridge]</code>部分中，将提供者虚拟网络映射到提供者物理网络接口：</p>
<blockquote>
<p>[linux_bridge]<br>physical_interface_mappings = provider:ens38</p>
</blockquote>
<p>替换<code>ens38</code>为基础提供程序物理网络接口的名称。有关 更多信息，请参阅<a href="https://docs.openstack.org/neutron/stein/install/environment-networking-ubuntu.html" target="_blank" rel="noopener">主机网络</a></p>
<p>在该<code>[vxlan]</code>部分中，启用VXLAN重叠网络，配置处理覆盖网络的物理网络接口的IP地址，并启用第2层填充：</p>
<blockquote>
<p>[vxlan]<br>enable_vxlan = true<br>local_ip = 192.168.2.52<br>l2_population = true</p>
</blockquote>
<p>替换<code>192.168.2.52</code>为处理覆盖网络的基础物理网络接口的IP地址。示例体系结构使用管理接口将流量隧道传输到其他节点。因此，请替换<code>OVERLAY_INTERFACE_IP_ADDRESS</code>为控制器节点的管理IP地址。有关更多信息，请参阅 <a href="https://docs.openstack.org/neutron/stein/install/environment-networking-ubuntu.html" target="_blank" rel="noopener">主机网络</a></p>
<p>在该<code>[securitygroup]</code>部分中，启用安全组并配置Linux网桥iptables防火墙驱动程序：</p>
<blockquote>
<p>[securitygroup]</p>
<p>enable_security_group = true<br>firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</p>
</blockquote>
<p>通过验证以下所有<code>sysctl</code>值都设置为<code>1</code>：确保您的Linux操作系统内核支持网桥过滤器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.bridge.bridge-nf-call-iptables</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line"></span><br><span class="line">sysctl net.bridge.bridge-nf-call-ip6tables</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br></pre></td></tr></table></figure>

<p>要启用网络桥接支持，通常<code>br_netfilter</code>需要加载内核模块，Ubuntu Server 18.04应该是默认加载的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br></pre></td></tr></table></figure>

<h5 id="配置第3层代理"><a href="#配置第3层代理" class="headerlink" title="配置第3层代理"></a>配置第3层代理</h5><p>第3层（L3）代理为自助服务虚拟网络提供路由和NAT服务。</p>
<p>编辑<code>/etc/neutron/l3_agent.ini</code>文件并完成以下操作：</p>
<p>在本<code>[DEFAULT]</code>节中，配置Linux桥接接口驱动程序和外部网桥：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>interface_driver = linuxbridge</p>
</blockquote>
<h5 id="配置DHCP代理"><a href="#配置DHCP代理" class="headerlink" title="配置DHCP代理"></a>配置DHCP代理</h5><p>DHCP代理为虚拟网络提供DHCP服务。</p>
<p>编辑<code>/etc/neutron/dhcp_agent.ini</code>文件并完成以下操作：<br>在本<code>[DEFAULT]</code>节中，配置Linux桥接接口驱动程序，Dnsmasq DHCP驱动程序，并启用隔离的元数据，以便提供商网络上的实例可以通过网络访问元数据：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>interface_driver = linuxbridge<br>dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq<br>enable_isolated_metadata = true</p>
</blockquote>
<h5 id="配置元数据代理"><a href="#配置元数据代理" class="headerlink" title="配置元数据代理"></a>配置元数据代理</h5><p>元数据代理提供配置信息，例如实例的凭证。</p>
<p>编辑<code>/etc/neutron/metadata_agent.ini</code>文件并完成以下操作：</p>
<p>在该<code>[DEFAULT]</code>部分中，配置元数据主机和共享密钥：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>nova_metadata_host = controller<br>metadata_proxy_shared_secret = METADATA_SECRET</p>
</blockquote>
<p>替换<code>METADATA_SECRET</code>为元数据代理的适当秘密。</p>
<h5 id="配置Compute服务以使用Networking服务"><a href="#配置Compute服务以使用Networking服务" class="headerlink" title="配置Compute服务以使用Networking服务"></a>配置Compute服务以使用Networking服务</h5><p>注意，必须安装Nova计算服务才能完成此步骤。有关更多详细信息，请参阅<a href="https://docs.openstack.org/" target="_blank" rel="noopener">docs网站</a>的“ 安装指南”部分 下的计算安装指南 。</p>
<p>编辑<code>/etc/nova/nova.conf</code>文件并执行以下操作：</p>
<p>在该<code>[neutron]</code>部分中，配置访问参数，启用元数据代理并配置密码：</p>
<blockquote>
<p>[neutron]</p>
<p>url = <a href="http://controller:9696" target="_blank" rel="noopener">http://controller:9696</a><br>auth_url = <a href="http://controller:5000" target="_blank" rel="noopener">http://controller:5000</a><br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>region_name = RegionOne<br>project_name = service<br>username = neutron<br>password = NEUTRON_PASS<br>service_metadata_proxy = true<br>metadata_proxy_shared_secret = METADATA_SECRET</p>
</blockquote>
<p>替换<code>NEUTRON_PASS</code>为您<code>neutron</code> 在Identity服务中为用户选择的密码。<br>替换<code>METADATA_SECRET</code>为您为元数据代理选择的秘密。</p>
<h5 id="完成安装"><a href="#完成安装" class="headerlink" title="完成安装"></a>完成安装</h5><p>填充数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c "neutron-db-manage --config-file /etc/neutron/neutron.conf \</span><br><span class="line">  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head" neutron</span><br></pre></td></tr></table></figure>

<p>注意，数据库填充稍后会出现在网络中，因为该脚本需要完整的服务器和插件配置文件。</p>
<ol>
<li><p>重新启动Compute API服务：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nova-api restart</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新启动网络服务。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">service neutron-server restart</span><br><span class="line">   service neutron-linuxbridge-agent restart</span><br><span class="line">   service neutron-dhcp-agent restart</span><br><span class="line">   service neutron-metadata-agent restart</span><br><span class="line">   service neutron-l3-agent restart</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="3-5-3-安装和配置计算节点"><a href="#3-5-3-安装和配置计算节点" class="headerlink" title="3.5.3 安装和配置计算节点"></a>3.5.3 安装和配置计算节点</h3><h5 id="安装组件-1"><a href="#安装组件-1" class="headerlink" title="安装组件"></a>安装组件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install neutron-linuxbridge-agent</span><br></pre></td></tr></table></figure>

<h5 id="配置公共组件"><a href="#配置公共组件" class="headerlink" title="配置公共组件"></a>配置公共组件</h5><p>Networking公共组件配置包括身份验证机制，消息队列和插件。</p>
<p>注意,默认配置文件因分发而异。您可能需要添加这些部分和选项，而不是修改现有的部分和选项。此外，<code>...</code>配置片段中的省略号（）表示您应保留的潜在默认配置选项。</p>
<p>编辑<code>/etc/neutron/neutron.conf</code>文件并完成以下操作：</p>
<p>在该<code>[database]</code>部分中，注释掉任何<code>connection</code>选项，因为计算节点不直接访问数据库。</p>
<p>在该<code>[DEFAULT]</code>部分中，配置<code>RabbitMQ</code> 消息队列访问：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>transport_url = rabbit://openstack:RABBIT_PASS@controller</p>
</blockquote>
<p>替换<code>RABBIT_PASS</code>为您<code>openstack</code> 在RabbitMQ中为帐户选择的密码。</p>
<p>在<code>[DEFAULT]</code>和<code>[keystone_authtoken]</code>部分中，配置身份服务访问：</p>
<blockquote>
<p>[DEFAULT]</p>
<p>auth_strategy = keystone</p>
<p>[keystone_authtoken]</p>
<p>www_authenticate_uri = <a href="http://controller:5000" target="_blank" rel="noopener">http://controller:5000</a><br>auth_url = <a href="http://controller:5000" target="_blank" rel="noopener">http://controller:5000</a><br>memcached_servers = controller:11211<br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>project_name = service<br>username = neutron<br>password = NEUTRON_PASS</p>
</blockquote>
<p>替换<code>NEUTRON_PASS</code>为您<code>neutron</code> 在Identity服务中为用户选择的密码。</p>
<p>注意，注释掉或删除该<code>[keystone_authtoken]</code>部分中的任何其他选项 。</p>
<p>在该<code>[oslo_concurrency]</code>部分中，配置锁定路径：</p>
<blockquote>
<p>[oslo_concurrency]</p>
<p>lock_path = /var/lib/neutron/tmp</p>
</blockquote>
<h5 id="配置网络选项-1"><a href="#配置网络选项-1" class="headerlink" title="配置网络选项"></a>配置网络选项</h5><p>选择为控制器节点选择的相同网络选项，以配置特定于其的服务。然后，返回此处并继续 <a href="https://docs.openstack.org/neutron/stein/install/compute-install-ubuntu.html#neutron-compute-compute-ubuntu" target="_blank" rel="noopener">配置计算服务以使用网络服务</a>。</p>
<p><a href="https://docs.openstack.org/neutron/stein/install/compute-install-option1-ubuntu.html" target="_blank" rel="noopener">网络选项1：提供商网络</a></p>
<p><a href="https://docs.openstack.org/neutron/stein/install/compute-install-option2-ubuntu.html" target="_blank" rel="noopener">网络选项2：自助服务网络</a></p>
<p><strong>这里依旧是选择第二个选项</strong></p>
<h5 id="配置Linux桥代理-1"><a href="#配置Linux桥代理-1" class="headerlink" title="配置Linux桥代理"></a>配置Linux桥代理</h5><p>Linux网桥代理为实例构建第2层（桥接和交换）虚拟网络基础架构并处理安全组。</p>
<p>编辑<code>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</code>文件并完成以下操作：<br>在该<code>[linux_bridge]</code>部分中，将提供者虚拟网络映射到提供者物理网络接口：</p>
<blockquote>
<p>[linux_bridge]<br>physical_interface_mappings = provider:ens38</p>
</blockquote>
<p>替换<code>ens38</code>为基础提供程序物理网络接口的名称。有关 更多信息，请参阅<a href="https://docs.openstack.org/neutron/stein/install/environment-networking-ubuntu.html" target="_blank" rel="noopener">主机网络</a></p>
<p>在该<code>[vxlan]</code>部分中，启用VXLAN重叠网络，配置处理覆盖网络的物理网络接口的IP地址，并启用第2层填充：</p>
<blockquote>
<p>[vxlan]<br>enable_vxlan = true<br>local_ip = 192.168.2.53<br>l2_population = true</p>
</blockquote>
<p>替换<code>192.168.2.53</code>为处理覆盖网络的基础物理网络接口的IP地址。</p>
<p>在该<code>[securitygroup]</code>部分中，启用安全组并配置Linux网桥iptables防火墙驱动程序：</p>
<blockquote>
<p>[securitygroup]</p>
<p>enable_security_group = true<br>firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</p>
</blockquote>
<p>通过验证以下所有<code>sysctl</code>值都设置为<code>1</code>：确保您的Linux操作系统内核支持网桥过滤器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.bridge.bridge-nf-call-iptables</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line"></span><br><span class="line">sysctl net.bridge.bridge-nf-call-ip6tables</span><br><span class="line"><span class="meta">#</span>输出</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br></pre></td></tr></table></figure>

<p>要启用网络桥接支持，通常<code>br_netfilter</code>需要加载内核模块，Ubuntu Server 18.04应该是默认加载的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br></pre></td></tr></table></figure>

<h5 id="配置Compute服务以使用Networking服务-1"><a href="#配置Compute服务以使用Networking服务-1" class="headerlink" title="配置Compute服务以使用Networking服务"></a>配置Compute服务以使用Networking服务</h5><p>编辑<code>/etc/nova/nova.conf</code>文件并完成以下操作：</p>
<p>在该<code>[neutron]</code>部分中，配置访问参数：</p>
<blockquote>
<p>[neutron]</p>
<p>url = <a href="http://controller:9696" target="_blank" rel="noopener">http://controller:9696</a><br>auth_url = <a href="http://controller:5000" target="_blank" rel="noopener">http://controller:5000</a><br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>region_name = RegionOne<br>project_name = service<br>username = neutron<br>password = NEUTRON_PASS</p>
</blockquote>
<p>替换<code>NEUTRON_PASS</code>为您<code>neutron</code> 在Identity服务中为用户选择的密码。</p>
<h5 id="完成安装-1"><a href="#完成安装-1" class="headerlink" title="完成安装"></a>完成安装</h5><ol>
<li><p>重新启动Compute服务：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nova-compute restart</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新启动Linux桥代理：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service neutron-linuxbridge-agent restart</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="3-6-仪表盘"><a href="#3-6-仪表盘" class="headerlink" title="3.6 仪表盘"></a>3.6 仪表盘</h2><h3 id="3-6-1-仪表盘仅在控制节点安装运行"><a href="#3-6-1-仪表盘仅在控制节点安装运行" class="headerlink" title="3.6.1 仪表盘仅在控制节点安装运行"></a>3.6.1 仪表盘仅在控制节点安装运行</h3><h4 id="安装和配置组件"><a href="#安装和配置组件" class="headerlink" title="安装和配置组件"></a>安装和配置组件</h4><ol>
<li><p>安装包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install openstack-dashboard</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑 <code>/etc/openstack-dashboard/local_settings.py</code> 文件并完成以下操作：</p>
<p>配置仪表板以在<code>controller</code>节点上使用OpenStack服务 ：</p>
<blockquote>
<p>OPENSTACK_HOST = “controller”</p>
</blockquote>
<p>在仪表板配置部分中，允许主机访问仪表板：</p>
<blockquote>
<p>ALLOWED_HOSTS = [‘one.example.com’, ‘two.example.com’]</p>
</blockquote>
<p>注意，不要<code>ALLOWED_HOSTS</code>在Ubuntu配置部分下编辑参数。<code>ALLOWED_HOSTS</code>也可以<code>[&#39;*&#39;]</code>接受所有主机。这可能对开发工作有用，但可能不安全，不应在生产中使用。有关详细信息，请参阅 <a href="https://docs.djangoproject.com/en/dev/ref/settings/#allowed-hosts" target="_blank" rel="noopener">Django文档</a>。</p>
<p>配置<code>memcached</code>会话存储服务：</p>
<blockquote>
<p>SESSION_ENGINE = ‘django.contrib.sessions.backends.cache’</p>
<p>  CACHES = {</p>
<pre><code>&apos;default&apos;: {
     &apos;BACKEND&apos;:    &apos;django.core.cache.backends.memcached.MemcachedCache&apos;,
     &apos;LOCATION&apos;: &apos;controller:11211&apos;,
}</code></pre><p>  }</p>
</blockquote>
</li>
</ol>
<p>注意，注释掉任何其他会话存储配置。</p>
<p>启用Identity API版本3：</p>
<blockquote>
<p>OPENSTACK_KEYSTONE_URL = “http://%s:5000/v3” % OPENSTACK_HOST</p>
</blockquote>
<p>启用对域的支持：</p>
<blockquote>
<p>OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</p>
</blockquote>
<p>配置API版本：</p>
<blockquote>
<p>OPENSTACK_API_VERSIONS = {<br>    “identity”: 3,<br>    “image”: 2,<br>    “volume”: 3,<br>    }</p>
</blockquote>
<p>配置<code>Default</code>为通过仪表板创建的用户的默认域：</p>
<blockquote>
<p>OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = “Default”</p>
</blockquote>
<p>配置<code>user</code>为通过仪表板创建的用户的默认角色：</p>
<blockquote>
<p>OPENSTACK_KEYSTONE_DEFAULT_ROLE = “user”</p>
</blockquote>
<p>如果选择网络选项1，请禁用对第3层网络服务的支持：</p>
<blockquote>
<p>OPENSTACK_NEUTRON_NETWORK = {</p>
<pre><code>&apos;enable_router&apos;: False,
&apos;enable_quotas&apos;: False,
&apos;enable_ipv6&apos;: False,
&apos;enable_distributed_router&apos;: False,
&apos;enable_ha_router&apos;: False,
&apos;enable_lb&apos;: False,
&apos;enable_firewall&apos;: False,
&apos;enable_vpn&apos;: False,
&apos;enable_fip_topology_check&apos;: False,
 }</code></pre></blockquote>
<p>（可选）配置时区：</p>
<blockquote>
<p>TIME_ZONE = “Asia/Shanghai”</p>
</blockquote>
<p>替换<code>TIME_ZONE</code>为适当的时区标识符。有关更多信息，请参阅<a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank" rel="noopener">时区列表</a>。</p>
<ol start="3">
<li><p><code>/etc/apache2/conf-available/openstack-dashboard.conf</code>如果未包含，请添加以下行 。</p>
<blockquote>
<p>WSGIApplicationGroup %{GLOBAL}</p>
</blockquote>
</li>
</ol>
<h4 id="完成安装-2"><a href="#完成安装-2" class="headerlink" title="完成安装"></a>完成安装</h4><p>重新加载Web服务器配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service apache2 reload</span><br></pre></td></tr></table></figure>

<h4 id="验证操作"><a href="#验证操作" class="headerlink" title="验证操作"></a>验证操作</h4><p>使用Web浏览器访问仪表板 <code>http://controller/horizon</code>。</p>
<p>使用<code>admin</code>或<code>demo</code>用户和<code>default</code>域凭据进行身份验证。</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>lengqing5977
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://www.lengqing.org/2019/07/18/Linux/openstack-install/" title="Ubuntu Server 18.04 安装 OpenStack Stein">https://www.lengqing.org/2019/07/18/Linux/openstack-install/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-hans" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2019/06/09/macOS/macOS-raid/" rel="next" title="macOS下的磁盘阵列">
                  <i class="fa fa-chevron-left"></i> macOS下的磁盘阵列
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2019/07/18/Linux/Ubuntu-change-hostname/" rel="prev" title="Ubuntu Server 18.04 修改主机名">
                  Ubuntu Server 18.04 修改主机名 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0-本文操作时的环境"><span class="nav-number">1.</span> <span class="nav-text">0 本文操作时的环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-安装前配置"><span class="nav-number">2.</span> <span class="nav-text">1 安装前配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-配置网络接口"><span class="nav-number">2.1.</span> <span class="nav-text">1.1 配置网络接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-1-控制节点"><span class="nav-number">2.1.1.</span> <span class="nav-text">1.1.1 控制节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-2-计算节点"><span class="nav-number">2.1.2.</span> <span class="nav-text">1.1.2 计算节点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-配置名称解析"><span class="nav-number">2.2.</span> <span class="nav-text">1.2 配置名称解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-1-控制节点"><span class="nav-number">2.2.1.</span> <span class="nav-text">1.2.1 控制节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-2-计算节点"><span class="nav-number">2.2.2.</span> <span class="nav-text">1.2.2 计算节点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-验证连接"><span class="nav-number">2.3.</span> <span class="nav-text">1.3 验证连接</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-1-控制节点"><span class="nav-number">2.3.1.</span> <span class="nav-text">1.3.1 控制节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-计算节点"><span class="nav-number">2.3.2.</span> <span class="nav-text">1.3.2 计算节点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-NTP网络时间协议"><span class="nav-number">2.4.</span> <span class="nav-text">1.4 NTP网络时间协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-1-控制节点"><span class="nav-number">2.4.1.</span> <span class="nav-text">1.4.1 控制节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-2-计算节点"><span class="nav-number">2.4.2.</span> <span class="nav-text">1.4.2 计算节点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-验证NTP设置"><span class="nav-number">2.5.</span> <span class="nav-text">1.5 验证NTP设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-1-控制节点"><span class="nav-number">2.5.1.</span> <span class="nav-text">1.5.1 控制节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-2-计算节点"><span class="nav-number">2.5.2.</span> <span class="nav-text">1.5.2 计算节点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-安装环境"><span class="nav-number">3.</span> <span class="nav-text">2 安装环境</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-为Ubuntu-Cloud-Archive启用存储库"><span class="nav-number">3.1.</span> <span class="nav-text">2.1 为Ubuntu Cloud Archive启用存储库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-这应该是所有节点都要做的"><span class="nav-number">3.1.1.</span> <span class="nav-text">2.1.1 这应该是所有节点都要做的</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-安装OpenStack客户端"><span class="nav-number">3.2.</span> <span class="nav-text">2.2 安装OpenStack客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-这应该是所有节点都要做的"><span class="nav-number">3.2.1.</span> <span class="nav-text">2.2.1 这应该是所有节点都要做的</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-数据库的安装与配置"><span class="nav-number">3.3.</span> <span class="nav-text">2.3 数据库的安装与配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-1-数据库仅需要在控制节点安装"><span class="nav-number">3.3.1.</span> <span class="nav-text">2.3.1 数据库仅需要在控制节点安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-消息队列"><span class="nav-number">3.4.</span> <span class="nav-text">2.4 消息队列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-1-消息队列仅在控制节点运行"><span class="nav-number">3.4.1.</span> <span class="nav-text">2.4.1 消息队列仅在控制节点运行</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-Memcached（身份验证）"><span class="nav-number">3.5.</span> <span class="nav-text">2.5 Memcached（身份验证）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-1-Memcached仅在控制节点运行"><span class="nav-number">3.5.1.</span> <span class="nav-text">2.5.1 Memcached仅在控制节点运行</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-Etcd（分布式键值对数据存储系统）"><span class="nav-number">3.6.</span> <span class="nav-text">2.6 Etcd（分布式键值对数据存储系统）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-1-Etcd仅在控制节点运行"><span class="nav-number">3.6.1.</span> <span class="nav-text">2.6.1 Etcd仅在控制节点运行</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-安装OpenStack服务"><span class="nav-number">4.</span> <span class="nav-text">3 安装OpenStack服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-身份服务"><span class="nav-number">4.1.</span> <span class="nav-text">3.1 身份服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-1-身份服务仅在控制节点上运行"><span class="nav-number">4.1.1.</span> <span class="nav-text">3.1.1 身份服务仅在控制节点上运行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-1-先决条件（创建数据库）"><span class="nav-number">4.1.1.1.</span> <span class="nav-text">3.1.1.1 先决条件（创建数据库）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-2-安装和配置组件"><span class="nav-number">4.1.1.2.</span> <span class="nav-text">3.1.1.2 安装和配置组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-3-配置Apache-HTTP服务器"><span class="nav-number">4.1.1.3.</span> <span class="nav-text">3.1.1.3 配置Apache HTTP服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-4-完成安装"><span class="nav-number">4.1.1.4.</span> <span class="nav-text">3.1.1.4 完成安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-5-创建域，项目，用户和角色"><span class="nav-number">4.1.1.5.</span> <span class="nav-text">3.1.1.5 创建域，项目，用户和角色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-6-验证操作"><span class="nav-number">4.1.1.6.</span> <span class="nav-text">3.1.1.6 验证操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-7-创建OpenStack客户端环境脚本"><span class="nav-number">4.1.1.7.</span> <span class="nav-text">3.1.1.7 创建OpenStack客户端环境脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-8-使用脚本"><span class="nav-number">4.1.1.8.</span> <span class="nav-text">3.1.1.8 使用脚本</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-映像服务"><span class="nav-number">4.2.</span> <span class="nav-text">3.2 映像服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-1-映像服务仅在控制节点运行"><span class="nav-number">4.2.1.</span> <span class="nav-text">3.2.1 映像服务仅在控制节点运行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-1-先决条件"><span class="nav-number">4.2.1.1.</span> <span class="nav-text">3.2.1.1 先决条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-2-安装和配置组件"><span class="nav-number">4.2.1.2.</span> <span class="nav-text">3.2.1.2 安装和配置组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-3-完成安装"><span class="nav-number">4.2.1.3.</span> <span class="nav-text">3.2.1.3 完成安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-4-验证操作"><span class="nav-number">4.2.1.4.</span> <span class="nav-text">3.2.1.4 验证操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-安置服务"><span class="nav-number">4.3.</span> <span class="nav-text">3.3 安置服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-安置服务仅运行在控制节点"><span class="nav-number">4.3.1.</span> <span class="nav-text">3.3.1 安置服务仅运行在控制节点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-1-先决条件"><span class="nav-number">4.3.1.1.</span> <span class="nav-text">3.3.1.1 先决条件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#创建数据库"><span class="nav-number">4.3.1.1.1.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置用户和端点"><span class="nav-number">4.3.1.1.2.</span> <span class="nav-text">配置用户和端点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-2-安装和配置组件"><span class="nav-number">4.3.1.2.</span> <span class="nav-text">3.3.1.2 安装和配置组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-3-完成安装"><span class="nav-number">4.3.1.3.</span> <span class="nav-text">3.3.1.3 完成安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-4-验证安装"><span class="nav-number">4.3.1.4.</span> <span class="nav-text">3.3.1.4 验证安装</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-计算服务"><span class="nav-number">4.4.</span> <span class="nav-text">3.4 计算服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-1-安装和配置控制节点"><span class="nav-number">4.4.1.</span> <span class="nav-text">3.4.1 安装和配置控制节点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-1-先决条件"><span class="nav-number">4.4.1.1.</span> <span class="nav-text">3.4.1.1 先决条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-2-安装和配置组件"><span class="nav-number">4.4.1.2.</span> <span class="nav-text">3.4.1.2 安装和配置组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-3-完成安装"><span class="nav-number">4.4.1.3.</span> <span class="nav-text">3.4.1.3 完成安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-2-安装并配置计算节点"><span class="nav-number">4.4.2.</span> <span class="nav-text">3.4.2 安装并配置计算节点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-1-安装和配置组件"><span class="nav-number">4.4.2.1.</span> <span class="nav-text">3.4.2.1 安装和配置组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-2-完成安装"><span class="nav-number">4.4.2.2.</span> <span class="nav-text">3.4.2.2 完成安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-3-到控制节点将计算节点添加到单元数据库"><span class="nav-number">4.4.3.</span> <span class="nav-text">3.4.3 到控制节点将计算节点添加到单元数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-4-验证操作"><span class="nav-number">4.4.4.</span> <span class="nav-text">3.4.4 验证操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-4-1-验证操作仅需在控制节点运行"><span class="nav-number">4.4.4.1.</span> <span class="nav-text">3.4.4.1 验证操作仅需在控制节点运行</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-网络服务"><span class="nav-number">4.5.</span> <span class="nav-text">3.5 网络服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-1-主机网络"><span class="nav-number">4.5.1.</span> <span class="nav-text">3.5.1 主机网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-2-安装和配置控制节点"><span class="nav-number">4.5.2.</span> <span class="nav-text">3.5.2 安装和配置控制节点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-2-1-先决条件"><span class="nav-number">4.5.2.1.</span> <span class="nav-text">3.5.2.1 先决条件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#配置网络选项"><span class="nav-number">4.5.2.1.1.</span> <span class="nav-text">配置网络选项</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#安装组件"><span class="nav-number">4.5.2.1.2.</span> <span class="nav-text">安装组件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置服务器组件"><span class="nav-number">4.5.2.1.3.</span> <span class="nav-text">配置服务器组件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置模块化第2层（ML2）插件¶"><span class="nav-number">4.5.2.1.4.</span> <span class="nav-text">配置模块化第2层（ML2）插件¶</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置Linux桥代理"><span class="nav-number">4.5.2.1.5.</span> <span class="nav-text">配置Linux桥代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置第3层代理"><span class="nav-number">4.5.2.1.6.</span> <span class="nav-text">配置第3层代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置DHCP代理"><span class="nav-number">4.5.2.1.7.</span> <span class="nav-text">配置DHCP代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置元数据代理"><span class="nav-number">4.5.2.1.8.</span> <span class="nav-text">配置元数据代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置Compute服务以使用Networking服务"><span class="nav-number">4.5.2.1.9.</span> <span class="nav-text">配置Compute服务以使用Networking服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#完成安装"><span class="nav-number">4.5.2.1.10.</span> <span class="nav-text">完成安装</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-3-安装和配置计算节点"><span class="nav-number">4.5.3.</span> <span class="nav-text">3.5.3 安装和配置计算节点</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装组件-1"><span class="nav-number">4.5.3.0.1.</span> <span class="nav-text">安装组件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置公共组件"><span class="nav-number">4.5.3.0.2.</span> <span class="nav-text">配置公共组件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置网络选项-1"><span class="nav-number">4.5.3.0.3.</span> <span class="nav-text">配置网络选项</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置Linux桥代理-1"><span class="nav-number">4.5.3.0.4.</span> <span class="nav-text">配置Linux桥代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置Compute服务以使用Networking服务-1"><span class="nav-number">4.5.3.0.5.</span> <span class="nav-text">配置Compute服务以使用Networking服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#完成安装-1"><span class="nav-number">4.5.3.0.6.</span> <span class="nav-text">完成安装</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-6-仪表盘"><span class="nav-number">4.6.</span> <span class="nav-text">3.6 仪表盘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-1-仪表盘仅在控制节点安装运行"><span class="nav-number">4.6.1.</span> <span class="nav-text">3.6.1 仪表盘仅在控制节点安装运行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装和配置组件"><span class="nav-number">4.6.1.1.</span> <span class="nav-text">安装和配置组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#完成安装-2"><span class="nav-number">4.6.1.2.</span> <span class="nav-text">完成安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#验证操作"><span class="nav-number">4.6.1.3.</span> <span class="nav-text">验证操作</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="lengqing5977"
    src="https://blog.lengqing.org/pics/blog/touxiangc.png">
  <p class="site-author-name" itemprop="name">lengqing5977</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/lengqing5977" title="GitHub &rarr; https://github.com/lengqing5977" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:root@lengqing.org" title="E-Mail &rarr; mailto:root@lengqing.org" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-hans" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lengqing5977</span>
</div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  


















  

  

  

</body>
</html>
